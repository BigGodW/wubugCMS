import{E as m,f as j,w as N,O as R,P as U,Q as V}from"./element-plus.js";import{u as H}from"./vue-router.js";import{H as Q,E as z,I as F}from"./@element-plus.js";import{l as k,a as G,b as L}from"./collect.js";import{c as O}from"./article.js";import{f as q}from"./index.js";import{r as s,I as J,j as K,ad as W,o as X,c as Y,M as o,Q as n,U as d,V as g,u as y}from"./@vue.js";import"./lodash-es.js";import"./async-validator.js";import"./dayjs.js";import"./@popperjs.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vanilla-jsoneditor.js";import"./json-source-map.js";import"./@jsonquerylang.js";import"./@fortawesome.js";import"./natural-compare-lite.js";import"./@codemirror.js";import"./@lezer.js";import"./crelt.js";import"./style-mod.js";import"./w3c-keyname.js";import"./@replit.js";import"./codemirror-wrapped-line-indent.js";import"./fast-deep-equal.js";import"./fast-uri.js";import"./jmespath.js";import"./jsonpath-plus.js";import"./immutable-json-patch.js";import"./jsonrepair.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css        */const Z={class:"bg-fff radius-6 pd-20"},Vt={__name:"index",setup(tt){const E=H(),T=s(null);s("");const h=s([]),x=s([]),v=s(0),b=s(1),i=s(0),A=J({cid:0,title:"",shortTitle:"",tagId:"",attr:[],source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用ChanCMS系统",status:"0",pv:1,link:""}),w=async()=>{try{const t=await k(b.value);t.code===200&&(h.value=[...t.data.list],v.value=t.data.count)}catch(t){console.log(t)}},S=t=>{b.value=t,k()},D=t=>{x.value=t},C=async t=>{try{const{pages:e,titleTag:a,articleTag:p,parseData:c,charset:l,cid:f,status:_}=t,r=e.split(","),u=await G({taskUrl:r[i.value],titleTag:a,articleTag:p,parseData:c,charset:l});if(u.code===200){const{title:M,article:P}=u.data;t.title=M,t.content=P,t.cid=f,t.status=_===1?1:0,I(t)}}catch(e){console.log(e)}},I=async t=>{try{const e={...A};e.attr=e.attr.toString(),e.tagId=e.tagId.toString(),!e.description&&e.content&&(e.description=q(e.content).substr(0,255));const a=await O({defaultParams:e,fieldParams:{}});a.code===200?(m({message:"第".concat(i.value+1,"条数据完成^_^"),type:"success"}),setTimeout(()=>{const{pages:p}=t,c=p.split(",");i.value<=c.length-1&&(C(t),i.value=i.value+1)},3e3)):m({message:a.msg||"第".concat(i.value+1,"条数据失败^_^"),type:"error"})}catch(e){console.log(e)}},$=t=>{const e=t.id;E.push({name:"collect-edit",params:{id:e}})},B=async t=>{const e=t.id;try{const a=await L(e);a.code===200?(m({message:"删除成功 ^_^",type:"success"}),w()):m({message:a.msg,type:"error"})}catch(a){console.log(a)}};return K(()=>{w()}),(t,e)=>{const a=j,p=W("router-link"),c=N,l=R,f=U,_=V;return X(),Y("div",Z,[o(c,{type:"flex",justify:"end"},{default:n(()=>[o(p,{to:"/collect/add"},{default:n(()=>[o(a,{type:"primary",round:""},{default:n(()=>e[0]||(e[0]=[d("新增")])),_:1})]),_:1})]),_:1}),o(f,{ref_key:"multipleTable",ref:T,data:h.value,"tooltip-effect":"dark","row-key":"id",onSelectionChange:D},{default:n(()=>[o(l,{type:"selection"}),o(l,{prop:"id",width:"60",label:"编号"}),o(l,{prop:"taskName",label:"任务名称"}),o(l,{prop:"category",label:"所属栏目"}),o(l,{prop:"charset",label:"编码"},{default:n(r=>[d(g(r.row.charset===1?"UTF-8":"GB2312"),1)]),_:1}),o(l,{prop:"status",label:"状态"},{default:n(r=>[d(g(r.row.status===1?"草稿":"发布"),1)]),_:1}),o(l,{prop:"updatedAt",label:"发布时间"},{default:n(r=>[d(g(r.row.updatedAt),1)]),_:1}),o(l,{fixed:"right",width:"222",label:"操作"},{default:n(r=>[o(a,{icon:y(Q),circle:"",onClick:u=>$(r.row)},null,8,["icon","onClick"]),o(a,{icon:y(z),circle:"",onClick:u=>B(r.row)},null,8,["icon","onClick"]),o(a,{type:"primary",round:"",icon:y(F),onClick:u=>C(r.row)},{default:n(()=>e[1]||(e[1]=[d("执行")])),_:2},1032,["icon","onClick"])]),_:1})]),_:1},8,["data"]),o(c,{type:"flex",class:"mt-20 align-c",justify:"center"},{default:n(()=>[o(_,{background:"",layout:"prev, pager, next",onCurrentChange:S,"page-size":10,total:v.value,"hide-on-single-page":""},null,8,["total"])]),_:1})])}}};export{Vt as default};
