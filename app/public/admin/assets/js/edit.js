import{E as V,m as qe,n as Je,x as ze,t as Ge,v as He,s as Ze,y as Ke,A as Qe,B as We,C as Xe,a as Ye,D as el,F as ll,G as al,f as tl,o as ol,w as sl,H as ul,I as dl,J as nl,K as rl,r as il,L as ml}from"./element-plus.js";import{r as n,I as pl,j as cl,ad as S,o as r,c as _,a as y,M as l,Q as t,R as c,W as T,_ as F,U as g,O as C,a8 as x,$,u as fl}from"./@vue.js";import{u as vl,a as gl}from"./vue-router.js";import{f as _l}from"./category.js";import{f as bl,a as Vl,d as yl,u as wl}from"./article.js";import{s as kl}from"./tag.js";import{v as Ul}from"./sys_config.js";import{t as Cl,_ as xl}from"./tinymce.js";import{D as El}from"./DialogCroper.js";import{_ as Il,d as Dl,a as de,t as jl,e as Al,b as Sl,c as Nl,f as Pl}from"./index.js";import{u as Rl,a as h}from"./upload.js";import"./lodash-es.js";import"./async-validator.js";import"./dayjs.js";import"./@element-plus.js";import"./@popperjs.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./vue-cropper.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vanilla-jsoneditor.js";import"./json-source-map.js";import"./@jsonquerylang.js";import"./@fortawesome.js";import"./natural-compare-lite.js";import"./@codemirror.js";import"./@lezer.js";import"./crelt.js";import"./style-mod.js";import"./w3c-keyname.js";import"./@replit.js";import"./codemirror-wrapped-line-indent.js";import"./fast-deep-equal.js";import"./fast-uri.js";import"./jmespath.js";import"./jsonpath-plus.js";import"./immutable-json-patch.js";import"./jsonrepair.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css        */const Bl={class:"bg-fff pd-10 radius-6"},Ll={class:"mr-10 ml-10"},Ol={class:"mr-10 ml-10 mb-20"},Tl={class:"cover row"},Fl={class:"cover flex align-center"},$l={class:"imgs-btn"},hl={__name:"edit",setup(Ml){const ne=vl(),re=gl(),M=n({...Cl}),N=n(!0),P=n([]),ie={checkStrictly:!0},q=n("first"),E=n("0"),J=n([]),me=n([]),z=n([]),R=n(!1),B=n(!1),G=n(1),H=n([]),I=n(),Z=n(),K=n(),Q=n(""),s=pl({id:0,cid:0,subCid:[],title:"",shortTitle:"",tagId:"",attr:[],articleView:"",source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"",status:"0",pv:1,link:""}),f=n([]);let b={};const W=n(""),L=n(!1),pe=n(1),O=n(!1),ce=n(["/public/cover/01.jpg","/public/cover/02.jpg","/public/cover/03.jpg","/public/cover/04.jpg","/public/cover/05.jpg","/public/cover/06.jpg","/public/cover/07.jpg","/public/cover/08.jpg","/public/cover/09.jpg","/public/cover/10.jpg"]),fe=async()=>{try{let o=await Ul();o.code===200&&(z.value=o.data.filter(e=>e!=="404.html"&&e!=="500.html").map(e=>({label:e,value:e})))}catch(o){console.log(o)}},ve=()=>{N.value=!1},ge=o=>{E.value=o.index},_e=o=>{s.img=o},X=async(o="")=>{try{let e=await kl(pe.value,o,100);e.code===200&&(H.value=e.data.list.map(u=>({label:u.name,value:u.id})))}catch(e){console.log(e)}},be=async()=>{try{let o=await _l();if(o.code===200){let e=o.data,u=Dl(s.cid,e);P.value=u;let p=de(jl(e));me.value=de(e),J.value=[...p],Y(s.cid)}}catch(o){console.log(o)}},Ve=o=>{o[0]!=-1?(s.cid=o[o.length-1],Y(s.cid)):f.value=[]},Y=async o=>{try{let e=await bl(o);e.code===200&&(e.data.fields.forEach(u=>{if(u.default&&u.default.includes("[{")&&u.default.includes("options")){let p=JSON.parse(u.default);u.default=p.options||[]}u.type=="8"&&(u.values=[])}),f.value=e.data.fields,f.value.forEach((u,p)=>{b[u.ename]&&b[u.ename].includes("[{")?u.values=JSON.parse(b[u.ename]):u.values=b[u.ename]}))}catch(e){console.log(e)}},ye=async()=>{try{let o=await Vl(s.id);if(o.code===200){let e=o.data;e.content=Al(e.content),e.attr=e.attr?e.attr.split(","):[],e.subCid=e.subCid?e.subCid.split(",").map(Number):[],e.oldTagId=e.tagId,e.tagId=e.tagId?e.tagId.split(",").map(Number):[],e.status=e.status.toString(),e.updatedAt=new Date(e.createdAt),Object.assign(s,e),b=e.field,N.value=!1}}catch(o){console.error(o)}},we=o=>{console.log("e-->",o)},ke=o=>{if(o.type.indexOf("image")===-1)return V({message:"上传文件只能是图片格式",type:"success"}),!1;I.value=o;const e=new FileReader;return e.onload=async u=>{let p;typeof u.target.result=="object"?p=window.URL.createObjectURL(new Blob([u.target.result])):p=u.target.result,Q.value=p,Z.value.dialogFormVisible=!0},e.readAsArrayBuffer(o),!0},Ue=async()=>{if(I.value.size/1024/1024>.2)return V({message:"上传图片必须小于200k",type:"success"}),!1;const o=new FormData;o.append("file",I.value);const e=await h(o);e.code===200&&(s.img=e.data.path)},Ce=o=>{if(o.type.indexOf("image")===-1)return V({message:"上传文件只能是图片格式",type:"success"}),!1;if(o.size/1024/1024>.2)return V({message:"上传图片必须小于200k",type:"success"}),!1},xe=async o=>{const{data:{index:e},file:u}=o;let p=new FormData;p.append("file",u);let w=await h(p);if(w.code===200){const{filename:d,path:i}=w.data;Array.isArray(f.value[e].values)?f.value[e].values.push({name:d,url:i}):f.value[e].values=[{name:d,url:i}]}},Ee=o=>{W.value=o.url,L.value=!0},Ie=async o=>{f.value.forEach((e,u)=>{Array.isArray(e.values)&&e.values.forEach((p,w)=>{p.url==o.url&&(De(o.url),e.values.splice(w,1))})})},De=async o=>{try{await yl(o)}catch(e){console.log(e)}},je=async()=>{try{let o={...s};o.attr=o.attr.toString(),o.subCid=o.subCid.toString(),o.tagId=o.tagId.toString(),!o.img&&R.value&&(o.img=Nl(o.content)[0]),!o.description&&B.value&&(o.description=Pl(o.content).substr(0,255)),f.value.map((u,p)=>{b[u.ename]=typeof u.values=="object"?JSON.stringify(u.values):u.values});let e=await wl({...o,field:b});e.code===200?(V({message:"更新成功^_^",type:"success"}),ne.go(-1)):V({message:e.msg,type:"success"})}catch(o){console.log(o)}},Ae=o=>{o&&o.validate((e,u)=>{if(e){if(s.cid===0){V({message:"请选择栏目^_^",type:"success"});return}je()}else return Sl(u),!1})};return cl(async()=>{s.id=re.params.id,await ye(),await be(),X(),fe(),M.value.images_upload_url=await Rl()}),(o,e)=>{const u=qe,p=Je,w=ze,d=Ge,i=He,v=Ze,Se=Ke,k=Qe,Ne=We,ee=Xe,Pe=S("MostlyCloudy"),D=Ye,le=el,ae=ll,U=al,te=tl,Re=ol,j=sl,oe=ul,se=dl,ue=nl,Be=S("ZoomIn"),Le=S("Delete"),Oe=rl,Te=S("Plus"),Fe=il,$e=ml;return r(),_("div",Bl,[y("div",Ll,[l(p,{modelValue:q.value,"onUpdate:modelValue":e[0]||(e[0]=a=>q.value=a),onTabClick:ge},{default:t(()=>[l(u,{label:"基本信息",name:"first"}),l(u,{label:"扩展信息",name:"second"}),f.value.length>0?(r(),c(u,{key:0,label:"模型信息",name:"three"})):T("",!0)]),_:1},8,["modelValue"])]),y("div",Ol,[l(Fe,{ref_key:"paramsRef",ref:K,model:s,"label-width":"90px"},{default:t(()=>[F((r(),_("div",null,[l(j,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"文章栏目"},{default:t(()=>[l(w,{props:ie,"show-all-levels":!1,modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value=a),options:J.value,onChange:Ve},null,8,["modelValue","options"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"文章标题",prop:"title",rules:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:100,message:"标题不能超过100个字",trigger:"blur"}]},{default:t(()=>[l(v,{modelValue:s.title,"onUpdate:modelValue":e[2]||(e[2]=a=>s.title=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"tag标签"},{default:t(()=>[l(Se,{modelValue:s.tagId,"onUpdate:modelValue":e[3]||(e[3]=a=>s.tagId=a),options:H.value,placeholder:"请选择标签",style:{width:"240px"},multiple:"",filterable:"",remote:"","remote-method":X},null,8,["modelValue","options"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"内容属性"},{default:t(()=>[l(Ne,{modelValue:s.attr,"onUpdate:modelValue":e[4]||(e[4]=a=>s.attr=a),onChange:we},{default:t(()=>[l(k,{label:"1",value:"1"},{default:t(()=>e[24]||(e[24]=[g("头条")])),_:1}),l(k,{label:"2",value:"2"},{default:t(()=>e[25]||(e[25]=[g("推荐")])),_:1}),l(k,{label:"3",value:"3"},{default:t(()=>e[26]||(e[26]=[g("轮播")])),_:1}),l(k,{label:"4",value:"4"},{default:t(()=>e[27]||(e[27]=[g("热门")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"发布时间"},{default:t(()=>[l(ee,{modelValue:s.createdAt,"onUpdate:modelValue":e[5]||(e[5]=a=>s.createdAt=a),type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{class:"flex",label:"缩略图"},{default:t(()=>[l(ae,{class:"avatar-uploader","http-request":Ue,"show-file-list":!1,"before-upload":ke},{default:t(()=>[l(le,{placement:"top-start",title:"上传",width:200,trigger:"hover",content:"上传图片作为封面图，大小200k内"},{reference:t(()=>[l(D,{class:"avatar-uploader-icon"},{default:t(()=>[l(Pe)]),_:1})]),_:1})]),_:1}),s.img?(r(),c(le,{key:0,placement:"right",width:400,trigger:"hover"},{reference:t(()=>[l(U,{class:"avatar-uploader-icon pointer ml-10",src:s.img},null,8,["src"])]),default:t(()=>[l(U,{style:{width:"100%"},src:s.img},null,8,["src"])]),_:1})):T("",!0),l(te,{type:"primary",class:"ml-10",onClick:e[6]||(e[6]=a=>O.value=!0)},{default:t(()=>e[28]||(e[28]=[g(" 默认封面图 ")])),_:1}),l(Re,{modelValue:O.value,"onUpdate:modelValue":e[7]||(e[7]=a=>O.value=a),title:"默认封面图",class:"w-300","with-header":!1},{default:t(()=>[y("div",Tl,[(r(!0),_(C,null,x(ce.value,(a,A)=>(r(),c(U,{key:A,src:a,onClick:m=>_e(a),fit:"cover"},null,8,["src","onClick"]))),128))])]),_:1},8,["modelValue"]),l(v,{class:"ml-10 flex-1",modelValue:s.img,"onUpdate:modelValue":e[8]||(e[8]=a=>s.img=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(d,{label:"内容摘要"},{default:t(()=>[l(v,{type:"textarea",rows:2,placeholder:"请输入内容",modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=a=>s.description=a)},null,8,["modelValue"])]),_:1}),l(d,{label:"文章内容"},{default:t(()=>[l(xl,{modelValue:s.content,"onUpdate:modelValue":e[10]||(e[10]=a=>s.content=a),setting:M.value,onInit:ve,"script-src":"/public/admin/tinymce/tinymce.min.js"},null,8,["modelValue","setting"])]),_:1}),l(j,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(d,{label:"自动封面"},{default:t(()=>[l(k,{modelValue:R.value,"onUpdate:modelValue":e[12]||(e[12]=a=>R.value=a)},{default:t(()=>[e[29]||(e[29]=g(" 文章第 ")),l(v,{modelValue:G.value,"onUpdate:modelValue":e[11]||(e[11]=a=>G.value=a),class:"w-80 mr-8 ml-8",placeholder:"请输入内容"},null,8,["modelValue"]),e[30]||(e[30]=g("张图 "))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(d,{label:"提取描述"},{default:t(()=>[l(k,{modelValue:B.value,"onUpdate:modelValue":e[13]||(e[13]=a=>B.value=a)},{default:t(()=>e[31]||(e[31]=[g("提取文章描述")])),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(d,{label:"是否显示"},{default:t(()=>[l(oe,{modelValue:s.status,"onUpdate:modelValue":e[14]||(e[14]=a=>s.status=a),value:"0"},{default:t(()=>e[32]||(e[32]=[g("发布")])),_:1},8,["modelValue"]),l(oe,{modelValue:s.status,"onUpdate:modelValue":e[15]||(e[15]=a=>s.status=a),value:"1"},{default:t(()=>e[33]||(e[33]=[g("不发布")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])),[[$,E.value==0],[$e,N.value]]),F(y("div",null,[l(j,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"短标题",prop:"name"},{default:t(()=>[l(v,{modelValue:s.shortTitle,"onUpdate:modelValue":e[16]||(e[16]=a=>s.shortTitle=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"内容模板"},{default:t(()=>[l(ue,{modelValue:s.articleView,"onUpdate:modelValue":e[17]||(e[17]=a=>s.articleView=a),placeholder:"请选择模板"},{default:t(()=>[(r(!0),_(C,null,x(z.value,a=>(r(),c(se,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"来源"},{default:t(()=>[l(v,{modelValue:s.source,"onUpdate:modelValue":e[18]||(e[18]=a=>s.source=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"作者"},{default:t(()=>[l(v,{modelValue:s.author,"onUpdate:modelValue":e[19]||(e[19]=a=>s.author=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"外链跳转"},{default:t(()=>[l(v,{modelValue:s.link,"onUpdate:modelValue":e[20]||(e[20]=a=>s.link=a),max:"120"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(d,{label:"浏览数"},{default:t(()=>[l(v,{modelValue:s.pv,"onUpdate:modelValue":e[21]||(e[21]=a=>s.pv=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],512),[[$,E.value==1]]),F(y("div",null,[l(j,{gutter:20},{default:t(()=>[(r(!0),_(C,null,x(f.value,(a,A)=>(r(),c(i,{key:A,sm:24,md:24,lg:24},{default:t(()=>[["1","7"].includes(a.type)?(r(),c(d,{key:0,label:a.cname},{default:t(()=>[l(v,{modelValue:a.values,"onUpdate:modelValue":m=>a.values=m,max:"120"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["2","9"].includes(a.type)?(r(),c(d,{key:1,label:a.cname},{default:t(()=>[l(v,{type:"textarea",rows:4,placeholder:"请输入内容",modelValue:a.values,"onUpdate:modelValue":m=>a.values=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["3","4","5"].includes(a.type)?(r(),c(d,{key:2,label:a.cname},{default:t(()=>[l(ue,{modelValue:a.values,"onUpdate:modelValue":m=>a.values=m,placeholder:"请选择"},{default:t(()=>[(r(!0),_(C,null,x(a.default,m=>(r(),c(se,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):a.type==="6"?(r(),c(d,{key:3,label:a.cname},{default:t(()=>[l(ee,{modelValue:a.values,"onUpdate:modelValue":m=>a.values=m,"default-value":new Date,type:"datetime",placeholder:"请选择"},null,8,["modelValue","onUpdate:modelValue","default-value"])]),_:2},1032,["label"])):a.type==="8"?(r(),c(d,{key:4,label:a.cname,class:"flex align-c justify-center"},{default:t(()=>[y("div",Fl,[(r(!0),_(C,null,x(a.values,(m,he)=>(r(),_("div",{class:"pos-r img-item",key:m.url},[(r(),c(U,{key:he,src:m.url,fit:"cover"},null,8,["src"])),y("div",$l,[l(D,{onClick:Me=>Ee(m)},{default:t(()=>[l(Be)]),_:2},1032,["onClick"]),l(D,{onClick:Me=>Ie(m)},{default:t(()=>[l(Le)]),_:2},1032,["onClick"])])]))),128))]),l(Oe,{modelValue:L.value,"onUpdate:modelValue":e[22]||(e[22]=m=>L.value=m)},{default:t(()=>[l(U,{"w-full":"",src:W.value,alt:"Preview Image"},null,8,["src"])]),_:1},8,["modelValue"]),l(ae,{multiple:"","http-request":xe,data:{...a,index:A},"before-upload":Ce,limit:10,"show-file-list":!1},{default:t(()=>[l(D,{class:"upload-icon"},{default:t(()=>[l(Te)]),_:1})]),_:2},1032,["data"])]),_:2},1032,["label"])):T("",!0)]),_:2},1024))),128))]),_:1})],512),[[$,E.value==2&&f.value.length>0]]),l(d,null,{default:t(()=>[l(te,{type:"primary",onClick:e[23]||(e[23]=a=>Ae(K.value))},{default:t(()=>e[34]||(e[34]=[g("保存")])),_:1})]),_:1})]),_:1},8,["model"])]),l(El,{ref_key:"dialogCrop",ref:Z,img:Q.value,file:I.value,onCrop:fl(h)},null,8,["img","file","onCrop"])])}}},Pa=Il(hl,[["__scopeId","data-v-ff73002b"]]);export{Pa as default};
