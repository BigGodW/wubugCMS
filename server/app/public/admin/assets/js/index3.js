import{Y as D,P as x,v as B,M as T}from"./@element-plus.js";import{s as q,d as g}from"./article.js";import{a as E}from"./category.js";import{_ as $,a as f,t as U}from"./index.js";import{ag as i,ar as P,o as y,c as j,Z as a,V as o,W as N,U as z,F,a as _,Y as d,t as L}from"./@vue.js";import"./api.js";import"./axios.js";import"./element-plus.js";import"./lodash-es.js";import"./@vueuse.js";import"./@popperjs.js";import"./@ctrl.js";import"./dayjs.js";import"./async-validator.js";import"./memoize-one.js";import"./escape-html.js";import"./normalize-wheel-es.js";import"./@floating-ui.js";import"./pinia.js";import"./vue-router.js";import"./js-cookie.js";const Y={name:"article-index",setup(){return{Edit:D,Delete:x,View:B,Search:T}},data:()=>({keywords:"",cid:0,cur:1,categorySelected:[],category:[],tableData:[],multipleSelection:[],count:0,loading:!0}),computed:{},created(){let{cur:e=1,cid:t=0,keywords:r=""}=this.$route.query;this.cur=+e,this.categorySelected=+t,this.keywords=r,this.queryCategory(),this.search()},watch:{$route(e,t){if(console.log(e),e.name=="article-index"){let{cur:r,cid:s,keywords:m}=e.query;this.cur=+r,this.cid=+s,this.keywords=m,this.search()}}},methods:{clearSearch(){this.$router.replace({name:"article-index",query:{cur:1,cid:0,keywords:""}})},doSearch(){this.$router.replace({name:"article-index",query:{cur:this.cur,cid:this.cid,keywords:this.keywords}}),this.search()},async search(){try{let e=await q(this.cur,this.keywords,this.cid);e.code===200&&(this.tableData=[...e.data.list],this.count=e.data.count,this.loading=!1)}catch(e){console.log(e)}},handleCurrentChange(e){this.loading=!0,this.cur=+e,this.doSearch()},toggleSelection(e){e?e.forEach(t=>{this.$refs.multipleTable.toggleRowSelection(t)}):this.$refs.multipleTable.clearSelection()},handleSelectionChange(e){this.multipleSelection=e},async queryCategory(){try{let e=await E();if(e.code===200){let t=f(U(e.data)),r=f(e.data);this.cateList=r,this.category=[...t]}}catch(e){console.log(e)}},handleChange(e){this.cid=e[e.length-1]},toEdit(e){let t=e.id;this.$router.push({name:"article-edit",params:{id:t}})},delSome(){let e=this.multipleSelection.map(t=>t.id);this.$confirm("此操作将永久删除, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{(await g(e.join(","))).code===200&&(this.$message({message:"删除成功 ^_^",type:"success"}),this.search())}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},async handleDel(e){let t=e.id;try{(await g(t)).code===200&&(this.$message({message:"文章删除成功 ^_^",type:"success"}),this.search())}catch(r){console.log(r)}}},onBeforeUnmount(){}},A={class:"mr-10"},M={style:{"margin-top":"20px"}};function R(e,t,r,s,m,n){const w=i("el-cascader"),C=i("el-input"),u=i("el-button"),h=i("el-row"),k=i("el-col"),b=i("router-link"),c=i("el-table-column"),S=i("el-table"),v=i("el-pagination"),V=P("loading");return y(),j(F,null,[a(h,{type:"flex",justify:"space-between"},{default:o(()=>[a(k,{span:18},{default:o(()=>[a(h,null,{default:o(()=>[_("div",A,[d(" 栏目筛选 "),a(w,{class:"w-auto ml-5","show-all-levels":!1,modelValue:e.categorySelected,"onUpdate:modelValue":t[0]||(t[0]=l=>e.categorySelected=l),options:e.category,onChange:n.handleChange},null,8,["modelValue","options","onChange"])]),a(C,{class:"mr-10 w-auto",placeholder:"请输入内容","suffix-icon":s.Search,modelValue:e.keywords,"onUpdate:modelValue":t[1]||(t[1]=l=>e.keywords=l),clearable:"",onClear:n.clearSearch},null,8,["suffix-icon","modelValue","onClear"]),a(u,{type:"primary",onClick:n.doSearch,round:""},{default:o(()=>[d("搜索")]),_:1},8,["onClick"])]),_:1})]),_:1}),a(b,{class:"c-fff add-btn",to:"/article/add"},{default:o(()=>[d("新增")]),_:1})]),_:1}),N((y(),z(S,{ref:"multipleTable",data:e.tableData,"tooltip-effect":"dark","row-key":"id",size:"small",onSelectionChange:n.handleSelectionChange},{default:o(()=>[a(c,{type:"selection"}),a(c,{prop:"id",label:"编号",width:"60",fixed:""}),a(c,{prop:"title",label:"标题"}),a(c,{prop:"name",label:"栏目",width:"80"}),a(c,{prop:"updatedAt",label:"更新时间",width:"160"}),a(c,{prop:"status",label:"状态",width:"60"},{default:o(l=>[d(L(l.row.status==0?"显示":"隐藏"),1)]),_:1}),a(c,{fixed:"right",label:"操作",width:"150"},{default:o(l=>[a(u,{icon:s.View,circle:"",onClick:p=>e.handleClick(l.row)},null,8,["icon","onClick"]),a(u,{icon:s.Edit,circle:"",onClick:p=>n.toEdit(l.row)},null,8,["icon","onClick"]),a(u,{icon:s.Delete,circle:"",onClick:p=>n.handleDel(l.row)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data","onSelectionChange"])),[[V,e.loading]]),a(h,{type:"flex",class:"mt-20",justify:"space-between"},{default:o(()=>[_("div",M,[d(" 批量操作： "),a(u,{onClick:n.delSome},{default:o(()=>[d("删除")]),_:1},8,["onClick"])]),a(v,{background:"",layout:"prev, pager, next",onCurrentChange:n.handleCurrentChange,"pager-size":10,total:e.count,currentPage:e.cur,"onUpdate:currentPage":t[2]||(t[2]=l=>e.cur=l),"hide-on-single-page":""},null,8,["onCurrentChange","total","currentPage"])]),_:1})],64)}const ue=$(Y,[["render",R]]);export{ue as default};
