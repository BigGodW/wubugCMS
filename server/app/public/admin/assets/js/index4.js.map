{"version":3,"file":"index4.js","sources":["../../../src/views/article/index.vue"],"sourcesContent":["<template>\n  <!-- 搜索区域 -->\n  <div class=\"search row justify-between align-c pd-20 mb-20\">\n    <el-form :inline=\"true\" :model=\"params\">\n      <el-form-item label=\"栏目筛选\" prop=\"keywords\">\n        <el-cascader\n          class=\"w-auto ml-5\"\n          :show-all-levels=\"false\"\n          v-model=\"categorySelected\"\n          :options=\"category\"\n          @change=\"handleChange\"\n        ></el-cascader>\n      </el-form-item>\n      <el-form-item label=\"标题\" prop=\"keywords\">\n        <el-input\n          class=\"mr-10 w-auto\"\n          placeholder=\"请输入文章标题\"\n          :suffix-icon=\"Search\"\n          v-model=\"keywords\"\n          clearable\n          @clear=\"clearSearch\"\n        ></el-input>\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"doSearch\" round>搜索</el-button>\n        <el-button @click=\"clearSearch\" round>清空</el-button>\n      </el-form-item>\n    </el-form>\n\n    <router-link to=\"/article/add\">\n      <el-button type=\"primary\" round>新增</el-button>\n    </router-link>\n  </div>\n\n  <el-table\n    ref=\"multipleTable\"\n    :data=\"tableData\"\n    tooltip-effect=\"dark\"\n    row-key=\"id\"\n    size=\"small\"\n    @selection-change=\"handleSelectionChange\"\n    v-loading=\"loading\"\n  >\n    <el-table-column type=\"selection\"></el-table-column>\n    <el-table-column prop=\"id\" label=\"编号\" width=\"60\" fixed></el-table-column>\n    <el-table-column prop=\"title\" label=\"标题\"></el-table-column>\n    <!-- <el-table-column prop=\"attr\" label=\"属性\">\n        <template #default=\"scope\">\n          <p v-if=\"scope.row.attr.includes('1')\">头条</p>\n          <p v-if=\"scope.row.attr.includes('2')\">推荐</p>\n        </template>\n      </el-table-column> -->\n    <el-table-column prop=\"name\" label=\"栏目\" width=\"80\"></el-table-column>\n    <!-- <el-table-column prop=\"pv\" label=\"浏览次数\"></el-table-column> -->\n    <el-table-column\n      prop=\"updatedAt\"\n      label=\"更新时间\"\n      width=\"160\"\n    ></el-table-column>\n    <el-table-column prop=\"status\" label=\"状态\" width=\"60\">\n      <template #default=\"scope\">{{\n        scope.row.status == 0 ? \"显示\" : \"隐藏\"\n      }}</template>\n    </el-table-column>\n    <el-table-column fixed=\"right\" label=\"操作\" width=\"150\">\n      <template #default=\"scope\">\n        <el-button\n          :icon=\"View\"\n          circle\n          @click=\"handleClick(scope.row)\"\n        ></el-button>\n        <el-button :icon=\"Edit\" circle @click=\"toEdit(scope.row)\"></el-button>\n        <el-button\n          :icon=\"Delete\"\n          circle\n          @click=\"handleDel(scope.row)\"\n        ></el-button>\n      </template>\n    </el-table-column>\n  </el-table>\n\n  <!-- 分页 -->\n  <el-row type=\"flex\" class=\"mt-20\" justify=\"space-between\">\n    <div style=\"margin-top: 20px\">\n      批量操作：\n      <el-button @click=\"delSome\">删除</el-button>\n    </div>\n    <el-pagination\n      background\n      layout=\"prev, pager, next\"\n      @current-change=\"handleCurrentChange\"\n      :pager-size=\"10\"\n      :total=\"count\"\n      v-model:currentPage=\"cur\"\n      hide-on-single-page\n    ></el-pagination>\n  </el-row>\n</template>\n\n<script>\nimport { Delete, Edit, View, Search } from \"@element-plus/icons-vue\";\nimport { search, del } from \"@/api/article.js\";\nimport { find } from \"@/api/category.js\";\nimport { addLabelValue, tree } from \"@/utils/tool.js\";\nexport default {\n  name: \"article-index\",\n  setup() {\n    return {\n      Edit,\n      Delete,\n      View,\n      Search,\n    };\n  },\n  data: () => {\n    return {\n      keywords: \"\",\n      cid: 0,\n      cur: 1,\n      categorySelected: [],\n      category: [], //当前所有栏目\n      tableData: [],\n      multipleSelection: [],\n      count: 0,\n      loading: true,\n    };\n  },\n  computed: {},\n  created() {\n    let { cur = 1, cid = 0, keywords = \"\" } = this.$route.query;\n\n    this.cur = +cur;\n    this.categorySelected = +cid;\n    this.keywords = keywords;\n    this.queryCategory();\n    this.search();\n  },\n\n  watch: {\n    $route(to, from) {\n      console.log(to);\n      if (to.name == \"article-index\") {\n        let { cur, cid, keywords } = to.query;\n        this.cur = +cur;\n        this.cid = +cid;\n        this.keywords = keywords;\n        this.search();\n      }\n    },\n  },\n  methods: {\n    //清空搜索\n    clearSearch() {\n      this.$router.replace({\n        name: \"article-index\",\n        query: { cur: 1, cid: 0, keywords: \"\" },\n      });\n    },\n\n    doSearch() {\n      this.$router.replace({\n        name: \"article-index\",\n        query: { cur: this.cur, cid: this.cid, keywords: this.keywords },\n      });\n      this.search();\n    },\n\n    //查询\n    async search() {\n      try {\n        let res = await search(this.cur, this.keywords, this.cid);\n        if (res.code === 200) {\n          this.tableData = [...res.data.list];\n          this.count = res.data.count;\n          this.loading = false;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //翻页\n    handleCurrentChange(e) {\n      this.loading = true;\n      this.cur = +e;\n      this.doSearch();\n    },\n\n    toggleSelection(rows) {\n      if (rows) {\n        rows.forEach((row) => {\n          this.$refs.multipleTable.toggleRowSelection(row);\n        });\n      } else {\n        this.$refs.multipleTable.clearSelection();\n      }\n    },\n\n    handleSelectionChange(val) {\n      this.multipleSelection = val;\n    },\n\n    //查询\n    async queryCategory() {\n      try {\n        let res = await find();\n        if (res.code === 200) {\n          let dataTree = addLabelValue(tree(res.data));\n          let data = addLabelValue(res.data);\n          this.cateList = data;\n          this.category = [...dataTree];\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //选择栏目\n    handleChange(e) {\n      this.cid = e[e.length - 1];\n    },\n\n    //跳转到编辑\n    toEdit(e) {\n      let id = e.id;\n      this.$router.push({ name: \"article-edit\", params: { id: id } });\n    },\n\n    delSome() {\n      let ids = this.multipleSelection.map((item) => {\n        return item.id;\n      });\n      this.$confirm(\"此操作将永久删除, 是否继续?\", \"提示\", {\n        confirmButtonText: \"确定\",\n        cancelButtonText: \"取消\",\n        type: \"warning\",\n      })\n        .then(async () => {\n          let res = await del(ids.join(\",\"));\n          if (res.code === 200) {\n            this.$message({\n              message: \"删除成功 ^_^\",\n              type: \"success\",\n            });\n            this.search();\n          }\n        })\n        .catch(() => {\n          this.$message({\n            type: \"info\",\n            message: \"已取消删除\",\n          });\n        });\n    },\n\n    //删除文章\n    async handleDel(e) {\n      let id = e.id;\n      try {\n        let res = await del(id);\n        if (res.code === 200) {\n          this.$message({\n            message: \"文章删除成功 ^_^\",\n            type: \"success\",\n          });\n          this.search();\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n  },\n  onBeforeUnmount() {},\n};\n</script>\n<style scoped>\n:deep(.el-form-item) {\n  margin-bottom: 0px;\n}\n</style>\n"],"names":["_hoisted_1","class","_hoisted_2","style","name","setup","Delete","Search","data","categorySelected","category","multipleSelection","count","created","this","queryCategory","watch","$route","to","from","console","log","cur","cid","keywords","query","methods","$router","replace","res","code","tableData","list","loading","error","doSearch","toggleSelection","rows","forEach","row","$refs","multipleTable","clearSelection","async","find","dataTree","addLabelValue","tree","cateList","handleChange","e","toEdit","delSome","ids","map","item","$confirm","cancelButtonText","type","then","del","join","$message","message","id","onBeforeUnmount","_createElementVNode","inline","model","_ctx","params","label","prop","options","onChange","$options","placeholder","$setup","clearable","onClear","clearSearch","onClick","round","ref","size","onSelectionChange","handleSelectionChange","width","fixed","icon","View","circle","$event","handleClick","scope","Edit","handleDel","justify","background","layout","onCurrentChange","handleCurrentChange","total","currentPage"],"mappings":"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"}