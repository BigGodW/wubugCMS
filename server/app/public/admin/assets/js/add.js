import{E as w,m as Oe,n as Me,x as qe,t as he,v as Je,s as ze,y as Ge,A as He,B as Ze,C as Ke,a as Qe,D as We,F as Xe,G as Ye,f as el,o as ll,w as al,H as tl,I as ol,J as sl,K as ul,r as rl,L as nl}from"./element-plus.js";import{I as se,r as n,j as dl,ad as A,o as d,c as V,a as y,M as l,Q as t,R as c,W as B,_ as F,U as _,O as U,a8 as C,$ as N,u as il}from"./@vue.js";import{u as ml,a as pl}from"./vue-router.js";import{f as cl}from"./category.js";import{f as fl,d as vl,c as _l}from"./article.js";import{s as gl}from"./tag.js";import{v as Vl}from"./sys_config.js";import{t as yl,_ as bl}from"./tinymce.js";import{D as wl}from"./DialogCroper.js";import{u as kl,a as $}from"./upload.js";import{_ as Ul,a as ue,t as Cl,s as El,g as xl,f as Il}from"./index.js";import"./lodash-es.js";import"./async-validator.js";import"./dayjs.js";import"./@element-plus.js";import"./@popperjs.js";import"./@ctrl.js";import"./memoize-one.js";import"./normalize-wheel-es.js";import"./vue-cropper.js";import"./pinia.js";import"./pinia-plugin-persist.js";import"./vanilla-jsoneditor.js";import"./json-source-map.js";import"./@jsonquerylang.js";import"./@fortawesome.js";import"./natural-compare-lite.js";import"./@codemirror.js";import"./@lezer.js";import"./crelt.js";import"./style-mod.js";import"./w3c-keyname.js";import"./@replit.js";import"./codemirror-wrapped-line-indent.js";import"./fast-deep-equal.js";import"./fast-uri.js";import"./jmespath.js";import"./jsonpath-plus.js";import"./immutable-json-patch.js";import"./jsonrepair.js";import"./axios.js";import"./js-cookie.js";import"./nprogress.js";/* empty css        */const Dl={class:"bg-fff pd-10 radius-6"},jl={class:"mr-10 ml-10"},Al={class:"mr-10 ml-10 mb-20"},Pl={class:"cover row"},Sl={class:"cover flex align-center"},Rl={class:"pos-r img-item"},Ll={class:"imgs-btn"},Tl={__name:"add",setup(Bl){const re=ml();pl();const O=se({...yl}),M=n(!0),q=n([-1]),ne={checkStrictly:!0},h=n("first"),E=n("0"),J=n([]),de=n([]),P=n([]),S=n(!1),R=n(!1),z=n(1),G=n([]),x=n(),H=n(),Z=n(),K=n(""),s=se({cid:0,title:"",shortTitle:"",tagId:"",attr:[],articleView:"",source:"",author:"",description:"",img:"",createdAt:new Date,updatedAt:new Date,content:"欢迎使用ChanCMS系统",status:"0",pv:1,link:""}),g=n([]),Q=n(""),L=n(!1);n(!1);const ie=n(1);n("");const T=n(!1),me=n(["/public/cover/01.jpg","/public/cover/02.jpg","/public/cover/03.jpg","/public/cover/04.jpg","/public/cover/05.jpg","/public/cover/06.jpg","/public/cover/07.jpg","/public/cover/08.jpg","/public/cover/09.jpg","/public/cover/10.jpg"]),pe=async()=>{try{const o=await Vl();o.code===200&&(P.value=o.data.filter(e=>!["404.html","500.html"].includes(e)).map(e=>({label:e,value:e})),console.log(P.value))}catch(o){console.error(o)}},W=async o=>{try{const e=await gl(ie.value,o);e.code===200&&e.data&&(G.value=e.data.list.map(u=>({label:u.name,value:u.id})))}catch(e){console.error(e)}},ce=async()=>{try{const o=await cl();if(o.code===200){const e=ue(Cl(o.data)),u=ue(o.data);de.value=u,J.value=[...e]}}catch(o){console.error(o)}},fe=o=>{o[0]!==-1?(s.cid=o[o.length-1],ve(s.cid)):g.value=[]},ve=async o=>{try{const e=await fl(o);e.code===200&&(e.data.fields.forEach(u=>{if(u.default&&u.default.includes("[{")&&u.default.includes("options")){const p=JSON.parse(u.default);u.default=p.options||[]}u.type==="8"&&(u.values=[])}),g.value=e.data.fields)}catch(e){console.error(e)}},_e=()=>{M.value=!1},ge=o=>{s.img=o},Ve=o=>{E.value=o.index},ye=o=>{if(o.type.indexOf("image")===-1)return w({message:"上传文件只能是图片格式",type:"success"}),!1;x.value=o;const e=new FileReader;return e.onload=async u=>{let p;typeof u.target.result=="object"?p=window.URL.createObjectURL(new Blob([u.target.result])):p=u.target.result,K.value=p,H.dialogFormVisible=!0},e.readAsArrayBuffer(o),!0},be=async()=>{if(x.value.size/1024/1024>.2)return w({message:"上传图片必须小于200k",type:"success"}),!1;const o=new FormData;o.append("file",x.value);const e=await $(o);e.code===200&&(s.img=e.data.path)},we=o=>{if(o.type.indexOf("image")===-1)return w({message:"上传文件只能是图片格式",type:"success"}),!1;if(o.size/1024/1024>.2)return w({message:"上传图片必须小于200k",type:"success"}),!1},ke=async o=>{const{data:{index:e},file:u}=o,p=new FormData;p.append("file",u);const f=await $(p);if(f.code===200){const{filename:r,path:i}=f.data;Array.isArray(g.value[e].values)?g.value[e].values.push({name:r,url:i}):g.value[e].values=[{name:r,url:i}]}},Ue=async o=>{Q.value=o.url,L.value=!0},Ce=async o=>{g.value.forEach((e,u)=>{Array.isArray(e.values)&&e.values.forEach((p,f)=>{p.url===o.url&&(Ee(o.url),e.values.splice(f,1))})})},Ee=async o=>{try{await vl(o)}catch(e){console.error(e)}},xe=async()=>{try{const o={...s};o.attr=s.attr.toString(),o.tagId=s.tagId.toString(),!s.img&&S.value&&(s.img=xl(s.content)[0]),!s.description&&R.value&&(s.description=Il(s.content).substr(0,255));const e=g.value.reduce((p,f)=>(p[f.ename]=Array.isArray(f.values)?JSON.stringify(f.values):f.values,p),{}),u=await _l({defaultParams:o,fieldParams:e});u.code===200?(w({message:"更新成功^_^",type:"success"}),re.go(-1)):$message({message:u.msg,type:"error"})}catch(o){console.error(o)}},Ie=async o=>{o&&await o.validate((e,u)=>{if(e){if(s.cid===0){w({message:"请选择栏目^_^",type:"success"});return}xe()}else El(u)})};return dl(async()=>{O.images_upload_url=await kl(),await ce(),await W(),await pe()}),(o,e)=>{const u=Oe,p=Me,f=qe,r=he,i=Je,v=ze,De=Ge,b=He,je=Ze,X=Ke,Ae=A("MostlyCloudy"),I=Qe,Y=We,ee=Xe,k=Ye,le=el,Pe=ll,D=al,ae=tl,te=ol,oe=sl,Se=A("ZoomIn"),Re=A("Delete"),Le=ul,Te=A("Plus"),Be=rl,Fe=nl;return d(),V("div",Dl,[y("div",jl,[l(p,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=a=>h.value=a),onTabClick:Ve},{default:t(()=>[l(u,{label:"基本信息",name:"first"}),l(u,{label:"扩展信息",name:"second"}),g.value.length>0?(d(),c(u,{key:0,label:"模型信息",name:"three"})):B("",!0)]),_:1},8,["modelValue"])]),y("div",Al,[l(Be,{ref_key:"paramsRef",ref:Z,model:s,"label-width":"90px"},{default:t(()=>[F((d(),V("div",null,[l(D,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"文章栏目"},{default:t(()=>[l(f,{props:ne,"show-all-levels":!1,modelValue:q.value,"onUpdate:modelValue":e[1]||(e[1]=a=>q.value=a),options:J.value,onChange:fe},null,8,["modelValue","options"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"文章标题",prop:"title",rules:[{required:!0,message:"请输入文章标题",trigger:"blur"},{min:1,max:100,message:"标题不能超过100个字",trigger:"blur"}]},{default:t(()=>[l(v,{modelValue:s.title,"onUpdate:modelValue":e[2]||(e[2]=a=>s.title=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"tag标签"},{default:t(()=>[l(De,{modelValue:s.tagId,"onUpdate:modelValue":e[3]||(e[3]=a=>s.tagId=a),options:G.value,placeholder:"请选择标签",style:{width:"240px"},multiple:"",filterable:"",remote:"","remote-method":W},null,8,["modelValue","options"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"内容属性"},{default:t(()=>[l(je,{modelValue:s.attr,"onUpdate:modelValue":e[4]||(e[4]=a=>s.attr=a)},{default:t(()=>[l(b,{label:"1",value:"1"},{default:t(()=>e[24]||(e[24]=[_("头条")])),_:1}),l(b,{label:"2",value:"2"},{default:t(()=>e[25]||(e[25]=[_("推荐")])),_:1}),l(b,{label:"3",value:"3"},{default:t(()=>e[26]||(e[26]=[_("轮播")])),_:1}),l(b,{label:"4",value:"4"},{default:t(()=>e[27]||(e[27]=[_("热门")])),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"发布时间"},{default:t(()=>[l(X,{modelValue:s.createdAt,"onUpdate:modelValue":e[5]||(e[5]=a=>s.createdAt=a),"default-value":new Date,type:"datetime",placeholder:"选择日期时间"},null,8,["modelValue","default-value"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{class:"flex",label:"缩略图"},{default:t(()=>[l(ee,{class:"avatar-uploader","http-request":be,"show-file-list":!1,"before-upload":ye},{default:t(()=>[l(Y,{placement:"top-start",title:"上传",width:200,trigger:"hover",content:"上传图片作为封面图，大小200k内"},{reference:t(()=>[l(I,{class:"avatar-uploader-icon"},{default:t(()=>[l(Ae)]),_:1})]),_:1})]),_:1}),s.img?(d(),c(Y,{key:0,placement:"right",width:400,trigger:"hover"},{reference:t(()=>[l(k,{class:"avatar-uploader-icon pointer ml-10",src:s.img},null,8,["src"])]),default:t(()=>[l(k,{style:{width:"100%"},src:s.img},null,8,["src"])]),_:1})):B("",!0),l(le,{type:"primary",class:"ml-10",onClick:e[6]||(e[6]=a=>T.value=!0)},{default:t(()=>e[28]||(e[28]=[_(" 默认封面图 ")])),_:1}),l(Pe,{modelValue:T.value,"onUpdate:modelValue":e[7]||(e[7]=a=>T.value=a),title:"默认封面图",class:"w-300","with-header":!1},{default:t(()=>[y("div",Pl,[(d(!0),V(U,null,C(me.value,(a,j)=>(d(),c(k,{key:j,src:a,onClick:m=>ge(a),fit:"cover"},null,8,["src","onClick"]))),128))])]),_:1},8,["modelValue"]),l(v,{class:"ml-10 flex-1",modelValue:s.img,"onUpdate:modelValue":e[8]||(e[8]=a=>s.img=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"内容摘要"},{default:t(()=>[l(v,{type:"textarea",rows:2,placeholder:"请输入内容",modelValue:s.description,"onUpdate:modelValue":e[9]||(e[9]=a=>s.description=a)},null,8,["modelValue"])]),_:1}),l(r,{label:"文章内容"},{default:t(()=>[l(bl,{modelValue:s.content,"onUpdate:modelValue":e[10]||(e[10]=a=>s.content=a),setting:O,onInit:_e,"script-src":"/public/admin/tinymce/tinymce.min.js"},null,8,["modelValue","setting"])]),_:1}),l(D,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(r,{label:"自动封面"},{default:t(()=>[l(b,{modelValue:S.value,"onUpdate:modelValue":e[12]||(e[12]=a=>S.value=a)},{default:t(()=>[e[29]||(e[29]=_(" 文章第 ")),l(v,{modelValue:z.value,"onUpdate:modelValue":e[11]||(e[11]=a=>z.value=a),class:"w-80 mr-8 ml-8",placeholder:"请输入内容"},null,8,["modelValue"]),e[30]||(e[30]=_("张图 "))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(r,{label:"提取描述"},{default:t(()=>[l(b,{modelValue:R.value,"onUpdate:modelValue":e[13]||(e[13]=a=>R.value=a)},{default:t(()=>e[31]||(e[31]=[_("提取文章描述")])),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12,lg:8},{default:t(()=>[l(r,{label:"是否显示"},{default:t(()=>[l(ae,{modelValue:s.status,"onUpdate:modelValue":e[14]||(e[14]=a=>s.status=a),value:"0"},{default:t(()=>e[32]||(e[32]=[_("发布")])),_:1},8,["modelValue"]),l(ae,{modelValue:s.status,"onUpdate:modelValue":e[15]||(e[15]=a=>s.status=a),value:"1"},{default:t(()=>e[33]||(e[33]=[_("不发布")])),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1})])),[[N,E.value==0],[Fe,M.value]]),F(y("div",null,[l(D,{gutter:20},{default:t(()=>[l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"短标题",prop:"name"},{default:t(()=>[l(v,{modelValue:s.shortTitle,"onUpdate:modelValue":e[16]||(e[16]=a=>s.shortTitle=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"内容模板"},{default:t(()=>[l(oe,{modelValue:s.articleView,"onUpdate:modelValue":e[17]||(e[17]=a=>s.articleView=a),placeholder:"请选择模板"},{default:t(()=>[(d(!0),V(U,null,C(P.value,a=>(d(),c(te,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"来源"},{default:t(()=>[l(v,{modelValue:s.source,"onUpdate:modelValue":e[18]||(e[18]=a=>s.source=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"作者"},{default:t(()=>[l(v,{modelValue:s.author,"onUpdate:modelValue":e[19]||(e[19]=a=>s.author=a)},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"外链跳转"},{default:t(()=>[l(v,{modelValue:s.link,"onUpdate:modelValue":e[20]||(e[20]=a=>s.link=a),max:"120"},null,8,["modelValue"])]),_:1})]),_:1}),l(i,{sm:24,md:12},{default:t(()=>[l(r,{label:"浏览数"},{default:t(()=>[l(v,{modelValue:s.pv,"onUpdate:modelValue":e[21]||(e[21]=a=>s.pv=a)},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})],512),[[N,E.value==1]]),F(y("div",null,[l(D,{gutter:20},{default:t(()=>[(d(!0),V(U,null,C(g.value,(a,j)=>(d(),c(i,{key:j,sm:24,md:24,lg:24},{default:t(()=>[["1","7"].includes(a.type)?(d(),c(r,{key:0,label:a.cname},{default:t(()=>[l(v,{modelValue:a.values,"onUpdate:modelValue":m=>a.values=m,max:"120"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["2","9"].includes(a.type)?(d(),c(r,{key:1,label:a.cname},{default:t(()=>[l(v,{type:"textarea",rows:4,placeholder:"请输入内容",modelValue:a.values,"onUpdate:modelValue":m=>a.values=m},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):["3","4","5"].includes(a.type)?(d(),c(r,{key:2,label:a.cname},{default:t(()=>[l(oe,{modelValue:a.values,"onUpdate:modelValue":m=>a.values=m,placeholder:"请选择"},{default:t(()=>[(d(!0),V(U,null,C(a.default,m=>(d(),c(te,{key:m.value,label:m.label,value:m.value},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"])):a.type==="6"?(d(),c(r,{key:3,label:a.cname},{default:t(()=>[l(X,{modelValue:a.values,"onUpdate:modelValue":m=>a.values=m,"default-value":new Date,type:"datetime",placeholder:"请选择"},null,8,["modelValue","onUpdate:modelValue","default-value"])]),_:2},1032,["label"])):a.type==="8"?(d(),c(r,{key:4,label:a.cname,class:"flex align-c justify-center"},{default:t(()=>[y("div",Sl,[(d(!0),V(U,null,C(a.values,(m,Ne)=>(d(),V("div",Rl,[(d(),c(k,{key:Ne,src:m.url,fit:"cover"},null,8,["src"])),y("div",Ll,[l(I,{onClick:$e=>Ue(m)},{default:t(()=>[l(Se)]),_:2},1032,["onClick"]),l(I,{onClick:$e=>Ce(m)},{default:t(()=>[l(Re)]),_:2},1032,["onClick"])])]))),256))]),l(Le,{modelValue:L.value,"onUpdate:modelValue":e[22]||(e[22]=m=>L.value=m)},{default:t(()=>[l(k,{"w-full":"",src:Q.value,alt:"Preview Image"},null,8,["src"])]),_:1},8,["modelValue"]),l(ee,{multiple:"","http-request":ke,data:{...a,index:j},"before-upload":we,limit:10,"show-file-list":!1},{default:t(()=>[l(I,{class:"upload-icon"},{default:t(()=>[l(Te)]),_:1})]),_:2},1032,["data"])]),_:2},1032,["label"])):B("",!0)]),_:2},1024))),128))]),_:1})],512),[[N,E.value==2&g.value.length>0]]),l(r,null,{default:t(()=>[l(le,{type:"primary",onClick:e[23]||(e[23]=a=>Ie(Z.value))},{default:t(()=>e[34]||(e[34]=[_("保存")])),_:1})]),_:1})]),_:1},8,["model"])]),l(wl,{ref_key:"dialogCrop",ref:H,img:K.value,file:x.value,onCrop:il($)},null,8,["img","file","onCrop"])])}}},Ia=Ul(Tl,[["__scopeId","data-v-65119edd"]]);export{Ia as default};
