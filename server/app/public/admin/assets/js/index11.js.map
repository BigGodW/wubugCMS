{"version":3,"file":"index11.js","sources":["../../../src/views/login/index.vue","../../../src/api/index.js"],"sourcesContent":["<template>\n  <div class=\"page\">\n    <div class=\"login\">\n      <h1 class=\"title row align-c\">\n        <IconLogo class=\"icon\"></IconLogo>\n        禅悦后台管理系统\n      </h1>\n      <div class=\"login-cont\">\n        <el-form\n          class=\"mt-20\"\n          ref=\"loginForm\"\n          :model=\"loginForm\"\n          label-width=\"70px\"\n          @keyup.enter=\"login\"\n        >\n          <el-form-item\n            label=\"用户名\"\n            prop=\"username\"\n            :rules=\"[\n              {\n                required: true,\n                message: '请输入用户名',\n                trigger: 'blur',\n              },\n            ]\"\n          >\n            <el-input v-model=\"loginForm.username\"></el-input>\n          </el-form-item>\n          <el-form-item\n            label=\"密码\"\n            prop=\"password\"\n            :rules=\"[\n              {\n                required: true,\n                message: '请输入密码',\n                trigger: 'blur',\n              },\n            ]\"\n          >\n            <el-input type=\"password\" v-model=\"loginForm.password\"></el-input>\n          </el-form-item>\n\n          <el-form-item\n            label=\"验证码\"\n            prop=\"captcha\"\n            :rules=\"[\n              {\n                required: true,\n                message: '请输入验证码',\n                trigger: 'blur',\n              },\n            ]\"\n          >\n            <el-row :gutter=\"20\">\n              <el-col :span=\"15\"\n                ><el-input\n                  v-model=\"loginForm.captcha\"\n                  placeholder=\"请输入验证码\"\n                ></el-input\n              ></el-col>\n              <el-col :span=\"4\">\n                <span\n                  class=\"captcha block pointer\"\n                  v-html=\"captcha\"\n                  @click=\"getCaptcha\"\n                ></span\n              ></el-col>\n            </el-row>\n          </el-form-item>\n\n          <el-form-item>\n            <el-button type=\"primary\" size=\"large\" @click=\"login\">\n              登录\n            </el-button>\n          </el-form-item>\n        </el-form>\n      </div>\n    </div>\n\n    <footer class=\"login-footer overflow-h\">\n      <p class=\"f-13 text-c mt-10 c-fff\">\n        &copy;\n        <a\n          href=\"http://www.chanyue.top\"\n          class=\"mr-5 c-fff\"\n          target=\"_blank\"\n          title=\"chanyue\"\n          >www.chanyue.top</a\n        >\n        禅悦系统 ● 位于南京 服务全国\n      </p>\n    </footer>\n  </div>\n</template>\n\n<script>\nimport { defineComponent } from \"vue\";\nimport { userStore } from \"@/stores/user\";\nimport { login, captcha } from \"@/api/index\";\nimport { setCookie, getCookie } from \"@/utils/tool.js\";\nimport IconLogo from \"@/components/icons/IconLogo.vue\";\nexport default defineComponent({\n  components: { IconLogo },\n  data() {\n    return {\n      loginForm: {\n        username: \"\",\n        password: \"\",\n        captcha: \"\", // 添加验证码属性\n      },\n      captcha: \"\", // 添加验证码图片链接属性\n    };\n  },\n  created() {\n    this.getCaptcha();\n  },\n  methods: {\n    async getCaptcha() {\n      try {\n        let v = Math.random().toString().slice(4, 8);\n        let res = await captcha(v);\n        this.captcha = res;\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    async login() {\n      const users = userStore();\n      this.$refs.loginForm.validate((valid) => {\n        if (valid) {\n          // 验证码验证逻辑\n          console.log();\n          if (\n            this.loginForm.captcha.toLowerCase() !==\n            getCookie(\"captcha\").toLowerCase()\n          ) {\n            // eslint-disable-next-line no-undef\n            ElMessage({\n              message: \"验证码错误\",\n              type: \"warning\",\n            });\n            return false;\n          }\n          // 登录逻辑 当需要返回用await 不需要返回值，可以用then\n          const { username, password } = this.loginForm;\n          users.login({ username, password }).then((res) => {\n            if (res.code == 500) {\n              // eslint-disable-next-line no-undef\n              ElNotification({\n                title: \"提示\",\n                message: \"登录失败\",\n                type: \"error\",\n              });\n              return false;\n            }\n            // eslint-disable-next-line no-undef\n            ElNotification({\n              title: \"提示\",\n              message: \"登录成功\",\n              duration: 800,\n              type: \"success\",\n            });\n\n            setCookie(\"username\", username);\n            this.$router.push({\n              path: this.$route.query.redirect || \"/\",\n            });\n          });\n        } else {\n          return false;\n        }\n      });\n    },\n  },\n});\n</script>\n<style lang=\"less\" scoped>\n.page {\n  background-image: linear-gradient(300deg, #778cca, #65de83);\n  min-height: 100vh;\n}\n\n.icon {\n  width: 42px;\n  height: 42px;\n  background: #f6f6f6;\n  border-radius: 50%;\n  padding: 4px;\n  margin-right: 5px;\n}\n.login {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-direction: column;\n  height: calc(100vh - 50px);\n  .title {\n    font-size: 36px;\n    margin-bottom: 20px;\n    color: #fff;\n    text-align: center;\n    font-weight: lighter;\n    font-family: \"chanyue\";\n  }\n  .login-cont {\n    max-width: 500px;\n    background-color: #fff;\n    border-radius: 6px;\n    padding: 20px;\n    margin: 20px;\n  }\n}\n.login-phone {\n  display: flex;\n}\n\n.captcha {\n  height: 32px;\n  width: 100px;\n  svg {\n    width: 100%;\n  }\n}\n\n// .login-wrap {\n//   min-height: 540px;\n// }\n\n.login-footer {\n  height: 50px;\n}\n\n.pointer {\n  cursor: pointer;\n}\n.mt-20 {\n  margin-top: 20px;\n}\n</style>\n","import http from \"../utils/http.js\";\nimport API from \"../config/index.js\";\n\n/**\n * @description 登录\n * @param {*} param\n */\nexport let login = ({ username, password }) => {\n  return http({\n    url: `${API.BASE_API}/api/admin/login`,\n    method: \"post\",\n    data: {\n      username,\n      password,\n    },\n  });\n};\n\n/**\n * @description 注册\n * @param {*} param\n */\nexport let create = ({ username, password }) => {\n  return http({\n    url: `${API.BASE_API}/api/auth/admin/create`,\n    method: \"post\",\n    data: {\n      username,\n      password,\n    },\n  });\n};\n\n//验证码\nexport let captcha = (ver) => {\n  return http({\n    url: `${API.BASE_API}/api/captcha?v=${ver}`,\n    method: \"get\",\n  });\n};\n"],"names":["_sfc_main","defineComponent","components","IconLogo","data","captcha","created","this","getCaptcha","methods","v","Math","random","toString","slice","ver","http","url","concat","API","BASE_API","method","res","console","log","error","$refs","loginForm","validate","valid","toLowerCase","getCookie","message","type","username","password","users","login","then","code","ElNotification","setCookie","$router","push","path","$route","query","redirect","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","href","target","title","_openBlock","_createElementBlock","_createElementVNode","ref","model","_ctx","onKeyup","_withKeys","label","prop","rules","modelValue","_cache","$event","placeholder","innerHTML","onClick","args","size"],"mappings":"4nBAqGAA,EAAAC,EAAA,CACEC,WAAA,CAAAC,SAAAA,GACAC,KAAA,KACE,oCAIIC,QAAA,iBAKN,OAAAC,GACEC,KAAAC,cAEFC,QAAA,CACE,gBAAAD,GACE,IACE,IAAAE,EAAAC,KAAAC,SAAAC,WAAAC,MAAA,EAAA,WCrFcC,IACbC,EAAK,CACVC,IAAK,GAAGC,OAAIC,EAAAC,SAAQ,mBAAkBF,OAAAH,GACtCM,OAAQ,SDoFJd,KAAAF,QAAAiB,WAEAC,QAAAC,IAAAC,EACF,CC1Fe,IAACV,6BD+FhBR,KAAAmB,MAAAC,UAAAC,UAAAC,IACE,IAAAA,WAAA,CAII,iBAAAtB,KAAAoB,UAAAtB,QAAAyB,gBACAC,EAAA,WAAAD,wBAIEE,QAAA,QACAC,KAAA,eAKJ,MAAAC,SAAAA,EAAAC,SAAAA,GAAA5B,KAAAoB,UACAS,EAAAC,MAAA,CAAAH,WAAAC,aAAAG,MAAAhB,IACE,GAAA,KAAAA,EAAAiB,YAEEC,EAAA,YAEER,QAAA,yBAMJQ,EAAA,YAEER,QAAA,oBAEAC,KAAA,YAGFQ,EAAA,WAAAP,GACA3B,KAAAmC,QAAAC,KAAA,CACEC,KAAArC,KAAAsC,OAAAC,MAAAC,UAAA,KACF,IAIJ,QA1KDC,EAAA,CAAAC,MAAA,QACEC,EAAA,CAAAD,MAAA,SACCE,EAAA,CAAAF,MAAA,qBAICG,EAAA,CAAAH,MAAA,oLA4EDI,KAAA,yBACAJ,MAAA,aACAK,OAAA,SACAC,MAAA,8IArFR,OAAAC,IAAAC,EAAA,MAAAT,EAAA,CACEU,EAAA,MAAAR,EAAA,CACEQ,EAAA,KAAAP,EAAA,uCAIAO,EAAA,MAAAN,EAAA,MAEIH,MAAA,QACAU,IAAA,YACCC,MAAAC,EAAAlC,UACD,cAAA,OACCmC,QAAAC,EAAAF,EAAAxB,MAAA,CAAA,iCAGC2B,MAAA,MACAC,KAAA,WACCC,MAAA,uEAQkBC,WAAAN,EAAAlC,UAAAO,SAAA,sBAAAkC,EAAA,KAAAA,EAAA,GAAAC,GAAAR,EAAAlC,UAAAO,SAAAmC,yCAGnBL,MAAA,KACAC,KAAA,WACCC,MAAA,sEAQSjC,KAAA,WAAyBkC,WAAAN,EAAAlC,UAAAQ,SAAA,sBAAAiC,EAAA,KAAAA,EAAA,GAAAC,GAAAR,EAAAlC,UAAAQ,SAAAkC,yCAInCL,MAAA,MACAC,KAAA,UACCC,MAAA,uIAWcC,WAAAN,EAAAlC,UAAAtB,QAAA,sBAAA+D,EAAA,KAAAA,EAAA,GAAAC,GAAAR,EAAAlC,UAAAtB,QAAAgE,GACTC,YAAA,kFAKArB,MAAA,wBACAsB,UAAAV,EAAAxD,QACCmE,QAAAJ,EAAA,KAAAA,EAAA,GAAA,IAAAK,IAAAZ,EAAArD,YAAAqD,EAAArD,cAAAiE,yEAOIxC,KAAA,UAAeyC,KAAA,QAAcF,QAAAX,EAAAxB"}