{"version":3,"file":"edit-legacy3.js","sources":["../../../src/views/category/edit.vue"],"sourcesContent":["<template>\n  <div class=\"mr-10 ml-10\">\n    <el-tabs v-model=\"activeName\" @tab-click=\"handleClick\">\n      <el-tab-pane label=\"基本信息\" name=\"first\"></el-tab-pane>\n      <el-tab-pane label=\"SEO设置\" name=\"second\"></el-tab-pane>\n    </el-tabs>\n  </div>\n\n  <div class=\"mr-10 ml-10 mb-20\">\n    <el-form\n      ref=\"params\"\n      :model=\"params\"\n      :rules=\"paramsRules\"\n      label-width=\"84px\"\n      class=\"w640\"\n    >\n      <div v-show=\"activeIndex == 0\">\n        <el-form-item label=\"上级栏目\">\n          <el-cascader\n            :props=\"categoryProps\"\n            :show-all-levels=\"false\"\n            v-model=\"categorySelected\"\n            :options=\"category\"\n            @change=\"handleChange\"\n            placeholder=\"不选择为顶级栏目\"\n          >\n          </el-cascader>\n        </el-form-item>\n\n        <el-form-item\n          label=\"栏目名称\"\n          prop=\"name\"\n          :rules=\"[\n            {\n              required: true,\n              message: '请输入栏目名称',\n              trigger: 'blur',\n            },\n            {\n              min: 1,\n              max: 10,\n              message: '栏目不能超过10个字',\n              trigger: 'blur',\n            },\n          ]\"\n        >\n          <el-input v-model=\"params.name\" @change=\"createPinyin\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目标识\">\n          <el-input v-model=\"params.pinyin\" @change=\"changePath\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目路径\">\n          <el-input v-model=\"params.path\" disabled></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目类型\">\n          <el-radio v-model=\"params.type\" label=\"0\">栏目</el-radio>\n          <el-radio v-model=\"params.type\" label=\"1\">单页</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"扩展模型\">\n          <el-radio-group v-model=\"params.mid\">\n            <el-radio label=\"0\">基本模型</el-radio>\n            <template v-if=\"modList.length > 0\">\n              <el-radio\n                v-for=\"(item, index) of modList\"\n                :key=\"index\"\n                :label=\"item.id\"\n              >\n                {{ item.model_name }}模型\n              </el-radio>\n            </template>\n          </el-radio-group>\n        </el-form-item>\n\n        <el-form-item label=\"是否显示\">\n          <el-radio v-model=\"params.status\" label=\"0\">显示</el-radio>\n          <el-radio v-model=\"params.status\" label=\"1\">隐藏</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"栏目排序\">\n          <el-input v-model=\"params.sort\"></el-input>\n        </el-form-item>\n      </div>\n\n      <div v-show=\"activeIndex == 1\">\n        <el-form-item label=\"栏目描述\">\n          <el-input v-model=\"params.description\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目链接\">\n          <el-input v-model=\"params.url\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"打开方式\">\n          <el-radio v-model=\"params.target\" label=\"0\">当前页面</el-radio>\n          <el-radio v-model=\"params.target\" label=\"1\">新页面</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"seo标题\">\n          <el-input v-model=\"params.seo_title\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"seo关键词\">\n          <el-input v-model=\"params.seo_keywords\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"seo描述\">\n          <el-input v-model=\"params.seo_description\"></el-input>\n        </el-form-item>\n      </div>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"submit('params')\">保存</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { find, findId, update } from \"@/api/category.js\";\nimport { addLabelValue, treeById, tree } from \"@/utils/tool.js\";\nimport { list } from \"@/api/model.js\";\nimport { pinyin } from \"pinyin-pro\";\nexport default {\n  name: \"category-edit\",\n  data: () => {\n    return {\n      id: 0, //栏目\n      categorySelected: [], //-1默认选中顶级栏目\n      categorySelectedPath: \"\",\n      categoryProps: { checkStrictly: true },\n\n      activeName: \"first\", //tab 默认显示第一个\n      activeIndex: \"0\", //tab 内容默认显示第一个\n\n      category: [], //当前所有栏目\n      modList: [], //模型列表\n      params: {\n        //接口入参\n        pid: 0,\n        seo_title: \"\",\n        seo_keywords: \"\",\n        seo_description: \"\",\n        name: \"\",\n        path: \"\",\n        pinyin: \"\",\n        mid: \"0\",\n        description: \"\",\n        url: \"\",\n        sort: 0,\n        type: \"0\",\n        target: \"0\",\n        status: \"0\",\n      },\n      paramsRules: {\n        //校验规则\n        name: [\n          { required: true, message: \"请输入栏目名称\", trigger: \"blur\" },\n          {\n            min: 2,\n            max: 10,\n            message: \"名称长度在 2 到 10 个字符之间\",\n            trigger: \"blur\",\n          },\n        ],\n      },\n    };\n  },\n\n  computed: {},\n\n  created() {\n    this.id = this.$route.params.id;\n    this.modelList();\n    this.query();\n    this.findById();\n  },\n\n  methods: {\n    createPinyin(v) {\n      this.params.pinyin = pinyin(v, { toneType: \"none\" }).replace(/\\s+/g, \"\");\n      this.params.path = this.categorySelectedPath\n        ? this.categorySelectedPath + this.params.pinyin\n        : \"/\" + this.categorySelectedPath + this.params.pinyin;\n    },\n\n    changePath(v) {\n      this.params.path = this.categorySelectedPath\n        ? this.categorySelectedPath + v\n        : \"/\" + this.categorySelectedPath + v;\n    },\n\n    handleClick(tab) {\n      this.activeIndex = tab.index;\n    },\n\n    //查询\n    async query() {\n      try {\n        let res = await find();\n        if (res.code === 200) {\n          let data = res.data;\n          this.cate = res.data;\n          let ids = treeById(this.id, data);\n          if (ids.length > 1) {\n            ids.length = ids.length - 1;\n          }\n          this.categorySelected = ids;\n          let end = addLabelValue(tree(data));\n          this.category = [...end];\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //模型列表\n    async modelList() {\n      try {\n        let res = await list(this.cur);\n        if (res.code === 200) {\n          this.modList = res.data.list.map((item) => {\n            item.id = item.id.toString();\n            return item;\n          });\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //查\n    async findById() {\n      try {\n        let res = await findId(this.id);\n        if (res.code === 200) {\n          this.params = res.data;\n          let path = [];\n          this.cate.forEach((sub) => {\n            if (sub.id == res.data.pid) {\n              path.push(\"/\" + sub.pinyin);\n            }\n          });\n\n          this.categorySelectedPath = path.join(\"\") + \"/\";\n        }\n      } catch (error) {\n        console.error(error);\n      }\n    },\n\n    handleChange(e) {\n      //获取路径\n      let path = [];\n      let ids = Object.values(e);\n      ids.forEach((item) => {\n        this.cate.forEach((sub) => {\n          if (sub.id == item) {\n            path.push(\"/\" + sub.pinyin);\n          }\n        });\n      });\n\n      this.categorySelectedPath = path.join(\"\") + \"/\";\n\n      this.params.path = this.categorySelectedPath + this.params.pinyin;\n\n      if (e[0] != -1) {\n        this.params.pid = e[e.length - 1];\n      }\n    },\n\n    //更新基本信息\n    async update() {\n      try {\n        let res = await update(this.params);\n        if (res.code) {\n          this.$message({\n            message: \"更新成功^_^\",\n            type: \"success\",\n          });\n          this.$router.go(-1);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    submit(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.update();\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n  },\n};\n</script>\n<style scoped></style>\n"],"names":["_hoisted_1","class","_hoisted_2","name","data","id","categorySelected","categoryProps","checkStrictly","activeName","category","modList","params","seo_keywords","seo_description","path","pinyin","mid","description","url","sort","type","max","trigger","created","this","modelList","findById","methods","createPinyin","v","toneType","replace","categorySelectedPath","handleClick","tab","res","find","code","cate","ids","length","end","addLabelValue","tree","console","log","error","list","map","item","join","handleChange","e","forEach","sub","update","$message","message","$router","go","submit","formName","$refs","validate","valid","_createElementVNode","onTabClick","$options","label","ref","model","_ctx","rules","paramsRules","props","options","onChange","placeholder","prop","modelValue","_cache","$event","changePath","disabled","_openBlock","_createElementBlock","_Fragment","key","_renderList","index","status","target","seo_title","onClick"],"mappings":"q9BA6HA,MA5HOA,EAAA,CAAAC,MAAA,eAOAC,EAAA,CAAAD,MAAA,mCAqHP,CACEE,KAAA,gBACAC,KAAAA,KACE,CACEC,GAAA,EACAC,iBAAA,2BAEAC,cAAA,CAAAC,eAAA,GAEAC,WAAA,wBAGAC,SAAA,GACAC,QAAA,GACAC,OAAA,oBAIEC,aAAA,GACAC,gBAAA,GACAX,KAAA,GACAY,KAAA,GACAC,OAAA,GACAC,IAAA,IACAC,YAAA,GACAC,IAAA,GACAC,KAAA,EACAC,KAAA,6FAQE,OAEEC,IAAA,gCAEAC,QAAA,wBASVC,OAAAA,iCAEEC,KAAAC,yBAEAD,KAAAE,YAGFC,QAAA,CACEC,YAAAA,CAAAC,GACEL,KAAAb,OAAAI,OAAAA,EAAAc,EAAA,CAAAC,SAAA,SAAAC,QAAA,OAAA,IACAP,KAAAb,OAAAG,KAAAU,KAAAQ,qBACER,KAAAQ,qBAAAR,KAAAb,OAAAI,uEAKFS,KAAAb,OAAAG,KAAAU,KAAAQ,iDAEE,IAAAR,KAAAQ,qBAAAH,GAGJI,WAAAA,CAAAC,2CAME,IACE,IAAAC,QAAAC,IACA,GAAA,MAAAD,EAAAE,KAAA,CACE,IAAAlC,EAAAgC,EAAAhC,KACAqB,KAAAc,KAAAH,EAAAhC,wBAEAoC,EAAAC,OAAA,iDAIA,IAAAC,EAAAC,EAAAC,EAAAxC,wBAEF,WAEAyC,QAAAC,IAAAC,EACF,GAIF,eAAArB,GACE,4BAEE,MAAAU,EAAAE,OACEb,KAAAd,QAAAyB,EAAAhC,KAAA4C,KAAAC,KAAAC,wCAMFL,QAAAC,IAAAC,EACF,GAIF,cAAApB,GACE,2BAEE,GAAA,MAAAS,EAAAE,KAAA,CACEb,KAAAb,OAAAwB,EAAAhC,2EAKE,IAGFqB,KAAAQ,qBAAAlB,EAAAoC,KAAA,IAAA,GACF,WAEAN,QAAAE,MAAAA,EACF,GAGFK,YAAAA,CAAAC,6BAIEC,SAAAJ,2BAEIK,EAAAlD,IAAA6C,uBAEA,GACF,IAGFzB,KAAAQ,qBAAAlB,EAAAoC,KAAA,IAAA,4HAWA,WACEK,EAAA/B,KAAAb,gBAEEa,KAAAgC,SAAA,CACEC,QAAA,UACArC,KAAA,YAEFI,KAAAkC,QAAAC,IAAA,aAGFf,QAAAC,IAAAC,EACF,GAGFc,MAAAA,CAAAC,GACErC,KAAAsC,MAAAD,GAAAE,UAAAC,IACE,IAAAA,uDAKA,uGAxSNC,EAAA,MAAAlE,EAAA,mFACiCmE,WAAAC,EAAAlC,mCAChBmC,MAAA,OAAalE,KAAA,eACbkE,MAAA,QAAclE,KAAA,oDAI/B+D,EAAA,MAAAhE,EAAA,MAEIoE,IAAA,SACCC,MAAAC,EAAA5D,OACA6D,MAAAD,EAAAE,YACD,cAAA,OACAzE,MAAA,kFAKO0E,MAAAH,EAAAjE,cACA,mBAAA,2FAEAqE,QAAAJ,EAAA9D,SACAmE,SAAAT,EAAAhB,aACD0B,YAAA,8EAMFT,MAAA,OACAU,KAAA,OACCN,MAAA,2HAckBO,WAAAR,EAAA5D,OAAAT,KAAA,sBAAA8E,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAAT,KAAA+E,GAAcL,SAAAT,EAAAvC,kGAIdmD,WAAAR,EAAA5D,OAAAI,OAAA,sBAAAiE,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAAI,OAAAkE,GAAgBL,SAAAT,EAAAe,gGAIhBH,WAAAR,EAAA5D,OAAAG,KAAA,sBAAAkE,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAAG,KAAAmE,GAAaE,SAAA,6EAIbJ,WAAAR,EAAA5D,OAAAS,KAAA,sBAAA4D,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAAS,KAAA6D,GAAab,MAAA,6DACbW,WAAAR,EAAA5D,OAAAS,KAAA,sBAAA4D,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAAS,KAAA6D,GAAab,MAAA,0GAIPW,WAAAR,EAAA5D,OAAAK,IAAA,sBAAAgE,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAAK,IAAAiE,yEAEPV,EAAA7D,QAAA8B,OAAA,GACd4C,GAAA,GAAAC,EAAAC,EAAA,CAAAC,IAAA,GAAAC,EAAAjB,EAAA7D,SAAA,CAAAuC,EAAAwC,cAEGF,IAAAE,gLAUYV,WAAAR,EAAA5D,OAAA+E,OAAA,sBAAAV,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAA+E,OAAAT,GAAeb,MAAA,6DACfW,WAAAR,EAAA5D,OAAA+E,OAAA,sBAAAV,EAAA,KAAAA,EAAA,GAAAC,GAAAV,EAAA5D,OAAA+E,OAAAT,GAAeb,MAAA,0GAIfW,WAAAR,EAAA5D,OAAAQ,KAAA,sBAAA6D,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAQ,KAAA8D,2HAMAF,WAAAR,EAAA5D,OAAAM,YAAA,sBAAA+D,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAM,YAAAgE,6EAIAF,WAAAR,EAAA5D,OAAAO,IAAA,sBAAA8D,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAO,IAAA+D,6EAIAF,WAAAR,EAAA5D,OAAAgF,OAAA,sBAAAX,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAgF,OAAAV,GAAeb,MAAA,+DACfW,WAAAR,EAAA5D,OAAAgF,OAAA,sBAAAX,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAgF,OAAAV,GAAeb,MAAA,4GAIfW,WAAAR,EAAA5D,OAAAiF,UAAA,sBAAAZ,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAiF,UAAAX,+EAIAF,WAAAR,EAAA5D,OAAAC,aAAA,sBAAAoE,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAC,aAAAqE,8EAIAF,WAAAR,EAAA5D,OAAAE,gBAAA,sBAAAmE,EAAA,MAAAA,EAAA,IAAAC,GAAAV,EAAA5D,OAAAE,gBAAAoE,iGAIV7D,KAAA,UAAgByE,QAAAb,EAAA,MAAAA,EAAA,IAAAC,GAAAd,EAAAP,OAAA"}