{"version":3,"file":"edit4.js","sources":["../../../src/views/category/edit.vue"],"sourcesContent":["<template>\n  <div class=\"mr-10 ml-10\">\n    <el-tabs v-model=\"activeName\" @tab-click=\"handleClick\">\n      <el-tab-pane label=\"基本信息\" name=\"first\"></el-tab-pane>\n      <el-tab-pane label=\"SEO设置\" name=\"second\"></el-tab-pane>\n    </el-tabs>\n  </div>\n\n  <div class=\"mr-10 ml-10 mb-20\">\n    <el-form\n      ref=\"params\"\n      :model=\"params\"\n      :rules=\"paramsRules\"\n      label-width=\"84px\"\n      class=\"w640\"\n    >\n      <div v-show=\"activeIndex == 0\">\n        <el-form-item label=\"上级栏目\" v-if=\"!params.pid == 0\">\n          <el-cascader\n            :props=\"categoryProps\"\n            :show-all-levels=\"false\"\n            :disabled=\"true\"\n            v-model=\"categorySelected\"\n            :options=\"category\"\n            @change=\"handleChange\"\n          >\n          </el-cascader>\n          不选择为顶级栏目\n        </el-form-item>\n\n        <el-form-item\n          label=\"栏目名称\"\n          prop=\"name\"\n          :rules=\"[\n            {\n              required: true,\n              message: '请输入栏目名称',\n              trigger: 'blur',\n            },\n            {\n              min: 1,\n              max: 10,\n              message: '栏目不能超过10个字',\n              trigger: 'blur',\n            },\n          ]\"\n        >\n          <el-input v-model=\"params.name\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目标识\">\n          <el-input v-model=\"params.pinyin\" disabled></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目路径\">\n          <el-input v-model=\"params.path\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目类型\">\n          <el-radio v-model=\"params.type\" label=\"0\">栏目</el-radio>\n          <el-radio v-model=\"params.type\" label=\"1\">单页</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"扩展模型\">\n          <el-radio-group v-model=\"params.mid\">\n            <el-radio label=\"0\">基本模型</el-radio>\n            <template v-if=\"modList.length > 0\">\n              <el-radio\n                v-for=\"(item, index) of modList\"\n                :key=\"index\"\n                :label=\"item.id\"\n              >\n                {{ item.model_name }}模型\n              </el-radio>\n            </template>\n          </el-radio-group>\n        </el-form-item>\n\n        <el-form-item label=\"是否显示\">\n          <el-radio v-model=\"params.status\" label=\"0\">显示</el-radio>\n          <el-radio v-model=\"params.status\" label=\"1\">隐藏</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"栏目排序\">\n          <el-input v-model=\"params.sort\"></el-input>\n        </el-form-item>\n      </div>\n\n      <div v-show=\"activeIndex == 1\">\n        <el-form-item label=\"栏目描述\">\n          <el-input v-model=\"params.description\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目链接\">\n          <el-input v-model=\"params.url\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"打开方式\">\n          <el-radio v-model=\"params.target\" label=\"0\">当前页面</el-radio>\n          <el-radio v-model=\"params.target\" label=\"1\">新页面</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"seo标题\">\n          <el-input v-model=\"params.seo_title\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"seo关键词\">\n          <el-input v-model=\"params.seo_keywords\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"seo描述\">\n          <el-input v-model=\"params.seo_description\"></el-input>\n        </el-form-item>\n      </div>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"submit('params')\">保存</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { find, findId, update } from \"@/api/category.js\";\nimport { addLabelValue, treeById, tree } from \"@/utils/tool.js\";\nimport { list } from \"@/api/model.js\";\nimport { pinyin } from \"pinyin-pro\";\nexport default {\n  name: \"category-edit\",\n  data: () => {\n    return {\n      id: 0, //栏目\n      categorySelected: [], //-1默认选中顶级栏目\n      categoryProps: { checkStrictly: true },\n\n      activeName: \"first\", //tab 默认显示第一个\n      activeIndex: \"0\", //tab 内容默认显示第一个\n\n      category: [], //当前所有栏目\n      modList: [], //模型列表\n      params: {\n        //接口入参\n        pid: 0,\n        seo_title: \"\",\n        seo_keywords: \"\",\n        seo_description: \"\",\n        name: \"\",\n        pinyin: \"\",\n        path: \"\",\n        mid: \"0\",\n        description: \"\",\n        url: \"\",\n        sort: 0,\n        type: \"0\",\n        target: \"0\",\n        status: \"0\",\n      },\n      paramsRules: {\n        //校验规则\n        name: [\n          { required: true, message: \"请输入栏目名称\", trigger: \"blur\" },\n          {\n            min: 2,\n            max: 10,\n            message: \"名称长度在 2 到 10 个字符之间\",\n            trigger: \"blur\",\n          },\n        ],\n      },\n    };\n  },\n\n  computed: {},\n  watch: {\n    \"params.name\": function (newv, oldv) {\n      this.params.pinyin = pinyin(newv, { toneType: \"none\" }).replace(\n        /\\s+/g,\n        \"\",\n      );\n      let path = this.params.path;\n      let pathArr = path.split(\"/\");\n      pathArr.length = pathArr.length - 1;\n      pathArr.push(this.params.pinyin);\n      this.params.path = pathArr.join(\"/\");\n    },\n  },\n  created() {\n    this.id = this.$route.params.id;\n    this.modelList();\n    this.query();\n    this.findById();\n  },\n\n  methods: {\n    handleClick(tab) {\n      this.activeIndex = tab.index;\n    },\n\n    //查询\n    async query() {\n      try {\n        let res = await find();\n        if (res.code === 200) {\n          let data = res.data;\n          let ids = treeById(this.id, data);\n          if (ids.length > 1) {\n            ids.length = ids.length - 1;\n          }\n          this.categorySelected = ids;\n          let end = addLabelValue(tree(data));\n          this.category = [...end];\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //模型列表\n    async modelList() {\n      try {\n        let res = await list(this.cur);\n        if (res.code === 200) {\n          this.modList = res.data.list.map((item) => {\n            item.id = item.id.toString();\n            return item;\n          });\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //查\n    async findById() {\n      try {\n        let res = await findId(this.id);\n        if (res.code === 200) {\n          this.params = res.data;\n        }\n      } catch (error) {\n        console.error(error);\n      }\n    },\n\n    handleChange(e) {\n      if (e[0] != -1) {\n        this.params.pid = e[e.length - 1];\n      }\n    },\n\n    //更新基本信息\n    async update() {\n      try {\n        let res = await update(this.params);\n        if (res.code) {\n          this.$message({\n            message: \"更新成功^_^\",\n            type: \"success\",\n          });\n          this.$router.go(-1);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    submit(formName) {\n      this.params.path = this.allPath;\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.update();\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n  },\n};\n</script>\n<style scoped></style>\n"],"names":["_hoisted_1","class","_hoisted_2","name","data","id","categorySelected","categoryProps","checkStrictly","activeName","category","modList","params","seo_keywords","seo_description","pinyin","path","mid","description","url","sort","type","max","trigger","watch","newv","oldv","pathArr","length","push","this","join","created","modelList","findById","methods","handleClick","tab","res","find","code","ids","end","addLabelValue","tree","console","log","error","list","map","item","handleChange","e","update","$message","message","$router","go","submit","formName","$refs","validate","valid","_createElementVNode","onTabClick","$options","label","ref","model","_ctx","rules","paramsRules","pid","props","disabled","options","onChange","prop","modelValue","_cache","$event","_openBlock","_createElementBlock","_Fragment","key","_renderList","index","status","target","seo_title","onClick"],"mappings":"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"}