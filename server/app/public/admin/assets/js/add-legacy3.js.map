{"version":3,"file":"add-legacy3.js","sources":["../../../src/views/article/add.vue"],"sourcesContent":["<template>\n  <div class=\"mr-10 ml-10\">\n    <el-tabs v-model=\"activeName\" @tab-click=\"handleClick\">\n      <el-tab-pane label=\"基本信息\" name=\"first\"></el-tab-pane>\n      <el-tab-pane label=\"扩展信息\" name=\"second\"></el-tab-pane>\n    </el-tabs>\n  </div>\n\n  <div class=\"mr-10 ml-10 mb-20\">\n    <el-form ref=\"params\" :model=\"params\" label-width=\"100px\" class>\n      <div v-show=\"activeIndex == 0\">\n        <el-form-item label=\"文章栏目\">\n          <el-cascader\n            :props=\"categoryProps\"\n            :show-all-levels=\"false\"\n            v-model=\"categorySelected\"\n            :options=\"category\"\n            @change=\"handleChange\"\n          ></el-cascader>\n        </el-form-item>\n\n        <el-form-item\n          label=\"文章标题\"\n          prop=\"title\"\n          :rules=\"[\n            {\n              required: true,\n              message: '请输入文章标题',\n              trigger: 'blur',\n            },\n            {\n              min: 1,\n              max: 50,\n              message: '栏目不能超过50个字',\n              trigger: 'blur',\n            },\n          ]\"\n        >\n          <el-input v-model=\"params.title\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"内容属性\">\n          <el-checkbox-group v-model=\"params.attr\" @change=\"handleAttr\">\n            <el-checkbox label=\"1\">头条</el-checkbox>\n            <el-checkbox label=\"2\">推荐</el-checkbox>\n            <el-checkbox label=\"3\">轮播</el-checkbox>\n            <el-checkbox label=\"4\">热门</el-checkbox>\n          </el-checkbox-group>\n        </el-form-item>\n\n        <el-form-item label=\"tag标签\">\n          <el-select-v2\n            v-model=\"params.tag_id\"\n            :options=\"taglist\"\n            placeholder=\"请选择标签\"\n            style=\"width: 240px\"\n            multiple\n            filterable\n            remote\n            :remote-method=\"searchTag\"\n          />\n        </el-form-item>\n\n        <!--\n          field_cname   中文名称 varchar 60\n          field_ename   英文名称 varchar 60\n          field_type\n          from表单类型\n          1单行文本（varchar）\n          2.多行文本\n          text 3.下拉菜单\n          text 4.单选\n          text 5.多选\n          6.时间和日期\n          field_default  字段配置 男 女\n          field_values   默认值可选 255\n          field_sort     字段顺序\n          -->\n\n        <el-form-item label=\"内容摘要\">\n          <el-input\n            type=\"textarea\"\n            :rows=\"2\"\n            placeholder=\"请输入内容\"\n            v-model=\"params.description\"\n          ></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"缩略图\">\n          <el-space wrap>\n            <el-upload\n              class=\"avatar-uploader\"\n              action=\"/api/upload\"\n              :on-success=\"upload\"\n              :show-file-list=\"false\"\n              :before-upload=\"beforeUpload\"\n            >\n              <el-image\n                style=\"width: 100%\"\n                v-if=\"params.img\"\n                :src=\"params.img\"\n              />\n              <el-icon v-else class=\"avatar-uploader-icon\"><Plus /></el-icon>\n            </el-upload>\n          </el-space>\n          <el-space wrap>\n            <el-input v-model=\"params.img\"></el-input>\n          </el-space>\n        </el-form-item>\n\n        <el-form-item label=\"文章内容\">\n          <vue3-tinymce\n            v-model=\"params.content\"\n            :setting=\"setting\"\n            script-src=\"/public/admin/tinymce/tinymce.min.js\"\n          />\n        </el-form-item>\n\n        <el-form-item label=\"内容功能\">\n          <el-checkbox v-model=\"autoImg\">\n            提取第\n            <el-input\n              v-model=\"picNum\"\n              class=\"w-80 mr-8 ml-8\"\n              placeholder=\"请输入内容\"\n            ></el-input\n            >张图片作封面\n          </el-checkbox>\n        </el-form-item>\n\n        <el-form-item label=\"提取文章描述\">\n          <el-checkbox v-model=\"autoDes\">提取文章描述</el-checkbox>\n        </el-form-item>\n\n        <el-form-item label=\"发布时间\">\n          <el-date-picker\n            v-model=\"params.createdAt\"\n            :default-value=\"new Date()\"\n            type=\"datetime\"\n            placeholder=\"选择日期时间\"\n          ></el-date-picker>\n        </el-form-item>\n\n        <el-form-item label=\"是否显示\">\n          <el-radio v-model=\"params.status\" label=\"0\">发布</el-radio>\n          <el-radio v-model=\"params.status\" label=\"1\">不发布</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"浏览数\">\n          <el-input v-model=\"params.pv\"></el-input>\n        </el-form-item>\n      </div>\n\n      <div v-show=\"activeIndex == 1\">\n        <el-form-item label=\"短标题\" prop=\"name\">\n          <el-input v-model=\"params.short_title\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"其它栏目\">\n          <div class=\"w-640\">\n            <el-checkbox-group v-model=\"params.sub_cid\" @change=\"handleSubCid\">\n              <el-checkbox\n                v-for=\"(item, index) in cateList\"\n                :key=\"index\"\n                :label=\"item.value\"\n                >{{ item.label }}</el-checkbox\n              >\n            </el-checkbox-group>\n            <p class=\"tips\">(可选发布到其它栏目)</p>\n          </div>\n        </el-form-item>\n\n        <el-form-item label=\"SEO标题\">\n          <el-input v-model=\"params.seo_title\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"SEO关键词\">\n          <el-input v-model=\"params.seo_keywords\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"SEO描述\">\n          <el-input v-model=\"params.seo_description\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"来源\">\n          <el-input v-model=\"params.source\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"作者\">\n          <el-input v-model=\"params.author\"></el-input>\n        </el-form-item>\n        <el-form-item label=\"外链跳转\">\n          <el-input v-model=\"params.link\" max=\"120\"></el-input>\n        </el-form-item>\n\n        <!--\n          field_cname   中文名称 varchar 60\n          field_ename   英文名称 varchar 60\n          field_type\n          from表单类型 1单行文本（varchar）\n          2.多行文本\n          text 3.下拉菜单\n          text 4.单选\n          text 5.多选\n          6.时间和日期\n          field_default  默认值可选 255\n          field_values   字段配置 男 女\n          field_sort     字段顺序\n          -->\n        <el-form-item\n          :label=\"item.field_cname\"\n          v-for=\"(item, index) of field\"\n          :key=\"index\"\n        >\n          <el-input\n            v-model=\"item.field_values\"\n            max=\"120\"\n            v-if=\"item.field_type === '1'\"\n          ></el-input>\n          <el-input\n            type=\"textarea\"\n            :rows=\"3\"\n            v-else-if=\"item.field_type === '2'\"\n            placeholder=\"请输入内容\"\n            v-model=\"item.field_values\"\n          ></el-input>\n          <el-input\n            type=\"textarea\"\n            :rows=\"3\"\n            v-else\n            placeholder=\"请输入内容\"\n            autosize=\"false\"\n            v-model=\"item.field_values\"\n          ></el-input>\n        </el-form-item>\n      </div>\n\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"submit('params')\">保存</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { find } from \"@/api/category.js\";\nimport { create, findField } from \"@/api/article.js\";\nimport { search } from \"@/api/tag.js\";\nimport Vue3Tinymce from \"@jsdawn/vue3-tinymce\";\nimport { tinymceSet } from \"@/config/tinymce.js\";\nimport { Plus } from \"@element-plus/icons-vue\";\nimport {\n  addLabelValue,\n  getImgUrlFromStr,\n  filterHtml,\n  filterBody,\n  tree,\n} from \"@/utils/tool.js\";\n\nexport default {\n  name: \"article-add\",\n  components: {\n    Vue3Tinymce,\n    Plus,\n  },\n  data: () => {\n    return {\n      setting: tinymceSet,\n\n      categorySelected: [], //-1默认选中顶级栏目\n      categoryProps: { checkStrictly: true },\n\n      activeName: \"first\", //tab 默认显示第一个\n      activeIndex: \"0\", //tab 内容默认显示第一个\n      category: [], //当前所有栏目\n      cateList: [], //所有栏目\n      autoImg: true,\n      autoDes: true,\n      picNum: 1,\n      taglist: [],\n      params: {\n        //接口入参\n        cid: 0,\n        sub_cid: [],\n        title: \"\",\n        short_title: \"\",\n        tag_id: \"\",\n        attr: [],\n        seo_title: \"\",\n        seo_keywords: \"\",\n        seo_description: \"\",\n        source: \"\",\n        author: \"\",\n        description: \"\",\n        img: \"\",\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        content: \"禅悦\",\n        status: \"0\",\n        pv: 0,\n        link: \"\",\n      },\n\n      field: [], //字段列表\n\n      dialogImageUrl: \"\",\n      dialogVisible: false,\n      disabled: false,\n      cur: 1,\n      keywords: \"\",\n    };\n  },\n  computed: {},\n  mounted() {},\n  created() {\n    this.query();\n    this.searchTag();\n  },\n  unmounted() {},\n  methods: {\n    handleClick(tab) {\n      this.activeIndex = tab.index;\n    },\n\n    setContent(article) {\n      this.params.content = article;\n    },\n\n    //查询标签\n    async searchTag(keywords) {\n      try {\n        let res = await search(this.cur, keywords);\n        if (res.code === 200) {\n          let arr = [];\n          res.data.list.forEach((item) => {\n            arr.push({\n              label: item.name,\n              value: item.id,\n            });\n          });\n\n          this.taglist = arr;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //查询\n    async query() {\n      try {\n        let res = await find();\n        if (res.code === 200) {\n          let dataTree = addLabelValue(tree(res.data));\n          let data = addLabelValue(res.data);\n          this.cateList = data;\n          this.category = [...dataTree];\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //选择栏目\n    handleChange(e) {\n      console.log(e);\n      if (e[0] != -1) {\n        this.params.cid = e[e.length - 1];\n        this.findField(this.params.cid);\n      } else {\n        this.field = [];\n      }\n    },\n\n    handleAttr(e) {\n      console.log(\"e-->\", e);\n    },\n\n    handleSubCid(e) {\n      console.log(\"e-->\", e);\n    },\n\n    beforeUpload(rawFile) {\n      if (rawFile.size / 1024 / 1024 > 2) {\n        this.$message(\"上传文件必须小于1M\");\n        return false;\n      }\n    },\n    //上传缩略图\n    upload(res) {\n      if (res.code === 200) {\n        this.params.img = res.data.path;\n      }\n    },\n\n    //查询\n    async findField(cid) {\n      try {\n        let res = await findField(cid);\n        if (res.code === 200) {\n          this.field = res.data.fields;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n    //新增\n    async create() {\n      try {\n        let params = { ...this.params };\n        params.attr = params.attr.toString();\n        params.sub_cid = params.sub_cid.toString();\n        params.tag_id = params.tag_id.toString();\n        //判断是否有缩略图\n        if (!params.img) {\n          params.img = getImgUrlFromStr(params.content)[0];\n        }\n        //提取255字符作为文章描述\n        if (!params.description) {\n          params.description = filterHtml(params.content).substr(0, 255);\n        }\n        //处理模型字段信息\n        let fieldParams = {};\n        this.field.map((item) => {\n          fieldParams[item.field_ename] = item.field_values;\n        });\n\n        let res = await create({\n          defaultParams: params,\n          fieldParams: fieldParams,\n        });\n        if (res.code) {\n          this.$message({\n            message: \"更新成功^_^\",\n            type: \"success\",\n          });\n          this.$router.go(-1);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    submit(formName) {\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.create();\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n  },\n};\n</script>\n<style scoped></style>\n"],"names":["_sfc_main","name","data","setting","tinymceSet","categorySelected","categoryProps","checkStrictly","activeName","category","cateList","picNum","params","title","short_title","tag_id","attr","seo_keywords","seo_description","source","author","description","img","createdAt","Date","updatedAt","link","field","dialogImageUrl","dialogVisible","disabled","created","this","searchTag","methods","handleClick","tab","setContent","article","res","search","cur","keywords","code","arr","list","forEach","item","push","label","taglist","console","log","error","find","dataTree","addLabelValue","tree","handleChange","e","findField","cid","handleSubCid","beforeUpload","rawFile","async","toString","sub_cid","fieldParams","create","defaultParams","$message","message","type","$router","go","submit","formName","$refs","validate","valid","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_createElementVNode","onTabClick","$options","ref","model","_ctx","props","options","onChange","prop","rules","modelValue","_cache","$event","handleAttr","placeholder","style","width","multiple","filterable","remote","rows","action","upload","content","status","pv","_openBlock","_createElementBlock","_Fragment","_renderList","index","key","_createTextVNode","_toDisplayString","seo_title","max","field_type","field_values","autosize","onClick"],"mappings":"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"}