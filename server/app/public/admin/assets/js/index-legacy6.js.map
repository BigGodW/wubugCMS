{"version":3,"file":"index-legacy6.js","sources":["../../../src/views/field/index.vue"],"sourcesContent":["<template>\n  <el-row type=\"flex\" class=\"mt-10 mb-10\" justify=\"end\">\n    <router-link\n      :to=\"{\n        name: 'field-add',\n        query: {\n          mid: query.mid,\n          table_name: table_name,\n          model_name: model_name,\n        },\n      }\"\n    >\n      <el-button type=\"primary\" round>新增</el-button>\n    </router-link>\n  </el-row>\n\n  <el-table\n    ref=\"multipleTable\"\n    :data=\"tableData\"\n    tooltip-effect=\"dark\"\n    style=\"width: 100%\"\n    row-key=\"id\"\n    size=\"small\"\n    @selection-change=\"handleSelectionChange\"\n    v-loading=\"loading\"\n  >\n    <el-table-column type=\"selection\" width=\"55\"></el-table-column>\n    <el-table-column prop=\"id\" label=\"编号\"></el-table-column>\n    <el-table-column prop=\"field_cname\" label=\"中文名称\"></el-table-column>\n    <el-table-column prop=\"field_ename\" label=\"字段名称\"></el-table-column>\n    <el-table-column prop=\"field_sort\" label=\"排序\"></el-table-column>\n    <el-table-column fixed=\"right\" label=\"操作\" width=\"150\">\n      <template #default=\"scope\">\n        <el-button :icon=\"Edit\" circle @click=\"toEdit(scope.row)\"></el-button>\n        <el-button\n          :icon=\"Delete\"\n          circle\n          @click=\"handleDel(scope.row)\"\n        ></el-button>\n      </template>\n    </el-table-column>\n  </el-table>\n\n  <el-row type=\"flex\" class=\"mt-20\" justify=\"space-between\">\n    <el-pagination\n      background\n      layout=\"prev, pager, next\"\n      @current-change=\"handleCurrentChange\"\n      :pager-size=\"10\"\n      :total=\"count\"\n      hide-on-single-page\n    ></el-pagination>\n  </el-row>\n</template>\n\n<script>\nimport { Delete, Edit, View, Search } from \"@element-plus/icons-vue\";\nimport { list, del } from \"@/api/field.js\";\nimport { hasUse } from \"@/api/model.js\";\nexport default {\n  name: \"field-index\",\n  setup() {\n    return {\n      Edit,\n      Delete,\n      View,\n      Search,\n    };\n  },\n  data: () => {\n    return {\n      query: {\n        mid: \"\",\n      },\n      model_name: \"\",\n      table_name: \"\",\n      multipleSelection: [],\n      tableData: [],\n      count: 0,\n      cur: 1,\n      loading: true,\n    };\n  },\n  computed: {},\n  created() {\n    this.query = this.$route.query;\n    this.list();\n  },\n  update() {},\n  methods: {\n    //查询\n    async list() {\n      try {\n        let res = await list(this.query.mid, this.cur);\n        if (res.code === 200) {\n          const data = res.data;\n          this.tableData = [...data.list];\n          this.model_name = data.model.model_name;\n          this.table_name = data.model.table_name;\n          this.count = data.count;\n          this.loading = false;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    toggleSelection(rows) {\n      if (rows) {\n        rows.forEach((row) => {\n          this.$refs.multipleTable.toggleRowSelection(row);\n        });\n      } else {\n        this.$refs.multipleTable.clearSelection();\n      }\n    },\n\n    handleSelectionChange(val) {\n      this.multipleSelection = val;\n    },\n\n    //翻页\n    handleCurrentChange(e) {\n      this.cur = Number(e);\n      sessionStorage.setItem(\"cur\", Number(e));\n      this.list();\n    },\n\n    //跳转到编辑\n    toEdit(e) {\n      console.log(e);\n      // model 创建模型 （添加栏目选择模型）->创建对应的表book（）->增加字段field\n\n      const { id, field_ename } = e;\n      this.$router.push({\n        name: \"field-edit\",\n        query: {\n          fid: id,\n          mid: this.query.mid,\n          table_name: field_ename,\n          model_name: this.model_name,\n        },\n      });\n    },\n    delSome() {},\n    async hasUse(id) {\n      return await hasUse(id);\n    },\n    //删除文章\n    async handleDel(e) {\n      let { id } = e;\n      try {\n        let _res = await this.hasUse(this.query.mid);\n        if (_res.data.count === 0) {\n          let res = await del(id);\n          if (res.code === 200) {\n            this.$message({\n              message: \"删除成功 ^_^\",\n              type: \"success\",\n            });\n            this.list();\n          }\n        } else {\n          this.$message({\n            message: \"当前模型正在使用，字段不能删除 ^_^\",\n            type: \"success\",\n          });\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n  },\n};\n</script>\n<style scoped></style>\n"],"names":["name","setup","Delete","Search","data","query","mid","multipleSelection","count","created","methods","res","list","this","cur","code","model_name","model","table_name","loading","console","log","error","toggleSelection","rows","forEach","row","$refs","multipleTable","clearSelection","Number","e","sessionStorage","setItem","toEdit","$router","push","fid","id","async","hasUse","handleDel","del","$message","message","type","class","justify","_ctx","round","ref","tableData","style","width","size","onSelectionChange","$options","handleSelectionChange","prop","label","fixed","icon","$setup","Edit","circle","onClick","$event","scope","background","layout","onCurrentChange","handleCurrentChange","total"],"mappings":"i4BA2DA,CACEA,KAAA,cACAC,MAAAA,KACE,QAEEC,OAAAA,SAEAC,OAAAA,IAGJC,KAAAA,KACE,CACEC,MAAA,CACEC,IAAA,gCAIFC,kBAAA,gBAEAC,MAAA,iCAMJC,OAAAA,wDAKAC,QAAA,cAGI,IACE,IAAAC,QAAAC,EAAAC,KAAAR,MAAAC,IAAAO,KAAAC,KACA,GAAA,MAAAH,EAAAI,KAAA,CACE,MAAAX,EAAAO,EAAAP,gCAEAS,KAAAG,WAAAZ,EAAAa,MAAAD,WACAH,KAAAK,WAAAd,EAAAa,MAAAC,WACAL,KAAAL,MAAAJ,EAAAI,MACAK,KAAAM,SAAA,CACF,WAEAC,QAAAC,IAAAC,EACF,GAGFC,eAAAA,CAAAC,GACEA,EACEA,EAAAC,SAAAC,sDAIAb,KAAAc,MAAAC,cAAAC,4FAUFhB,KAAAC,IAAAgB,OAAAC,GACAC,eAAAC,QAAA,MAAAH,OAAAC,iBAKFG,MAAAA,CAAAH,GACEX,QAAAC,IAAAU,+BAIAlB,KAAAsB,QAAAC,KAAA,CACEpC,KAAA,aACAK,MAAA,CACEgC,IAAAC,EACAhC,IAAAO,KAAAR,MAAAC,4DAONiC,OAAAC,MAAAF,SACEE,EAAAF,GAGF,eAAAG,CAAAV,GACE,IAAAO,GAAAA,GAAAP,EACA,eACElB,KAAA2B,OAAA3B,KAAAR,MAAAC,iBAGE,aADAoC,EAAAJ,IACAvB,OACEF,KAAA8B,SAAA,CACEC,QAAA,WACAC,KAAA,yBAKJhC,KAAA8B,SAAA,+BAEEE,KAAA,qBAIJzB,QAAAC,IAAAC,EACF,iHAzKIuB,KAAA,OAAYC,MAAA,cAAoBC,QAAA,yDAE8BzC,IAAA0C,EAAA3C,MAAAC,6EASvDuC,KAAA,UAAeI,MAAA,6EAK5BC,IAAA,gBACC9C,KAAA4C,EAAAG,UACD,iBAAA,OACAC,MAAA,CAAAC,MAAA,QACA,UAAA,KACAC,KAAA,QACCC,kBAAAC,EAAAC,6CAGgBZ,KAAA,YAAiBQ,MAAA,YACjBK,KAAA,KAAUC,MAAA,YACVD,KAAA,cAAmBC,MAAA,cACnBD,KAAA,cAAmBC,MAAA,cACnBD,KAAA,aAAkBC,MAAA,YAClBC,MAAA,QAAcD,MAAA,KAAWN,MAAA,4BAE1BQ,KAAAC,EAAAC,KAAYC,OAAA,GAAQC,QAAAC,GAAAV,EAAAtB,OAAAiC,EAAAzC,sCAE7BmC,KAAAC,EAAA5D,OACD8D,OAAA,GACCC,QAAAC,GAAAV,EAAAf,UAAA0B,EAAAzC,yGAMDmB,KAAA,OAAYC,MAAA,QAAcC,QAAA,uCAE9BqB,WAAA,GACAC,OAAA,oBACCC,gBAAAd,EAAAe,oBACA,aAAA,GACAC,MAAAxB,EAAAxC,MACD,sBAAA"}