{"version":3,"file":"@jsdawn-legacy.js","sources":["../../../node_modules/@jsdawn/vue3-tinymce/dist/vue3-tinymce.es.js"],"sourcesContent":["import { reactive, watch, onMounted, onActivated, onDeactivated, onBeforeUnmount, openBlock, createElementBlock, Fragment, createElementVNode, toDisplayString, createCommentVNode } from \"vue\";\nconst uuid = (prefix) => {\n  return prefix + \"_\" + (Date.now() + Math.floor(Math.random() * 1e6));\n};\nconst getTinymce = () => {\n  const root = typeof window !== \"undefined\" ? window : global;\n  return root && \"tinymce\" in root ? root.tinymce : null;\n};\nfunction getContent(editor) {\n  if (!editor)\n    return \"\";\n  return editor.getContent();\n}\nfunction setContent(val, editor) {\n  if (!editor)\n    return;\n  editor.setContent(val);\n}\nfunction resetContent(val, editor) {\n  if (!editor)\n    return;\n  if (!!editor.resetContent)\n    return editor.resetContent(val);\n  editor.setContent(val);\n  editor.setDirty(false);\n  editor.undoManager.clear();\n}\nfunction setModeDisabled(editor, disabled = true) {\n  if (!editor)\n    return;\n  editor.mode.set(disabled ? \"readonly\" : \"design\");\n}\nfunction imageUploadHandler(setting, blobInfo, progress) {\n  return new Promise((resolve, reject) => {\n    let {\n      images_upload_url,\n      images_upload_credentials,\n      custom_images_upload_header,\n      custom_images_upload_param,\n      custom_images_upload_callback\n    } = setting || {};\n    let xhr, formData;\n    xhr = new XMLHttpRequest();\n    xhr.withCredentials = !!images_upload_credentials;\n    xhr.open(\"POST\", images_upload_url || \"\");\n    if (custom_images_upload_header) {\n      Object.keys(custom_images_upload_header).forEach((key) => {\n        xhr.setRequestHeader(key, custom_images_upload_header[key]);\n      });\n    }\n    xhr.upload.onprogress = function(e) {\n      progress(e.loaded / e.total * 100);\n    };\n    xhr.onload = function() {\n      if (xhr.status === 403) {\n        reject({ message: \"HTTP Error: \" + xhr.status, remove: true });\n        return;\n      }\n      if (xhr.status < 200 || xhr.status >= 300) {\n        reject(\"HTTP Error: \" + xhr.status);\n        return;\n      }\n      let json = JSON.parse(xhr.responseText);\n      if (!json) {\n        reject(\"Invalid JSON: \" + xhr.responseText);\n        return;\n      }\n      let backImgUrl = typeof custom_images_upload_callback === \"function\" ? custom_images_upload_callback(json) : json.location;\n      if (!backImgUrl) {\n        reject(\"Failed Path: location image path is error/empty\");\n        return;\n      }\n      resolve(backImgUrl);\n    };\n    xhr.onerror = function() {\n      reject(\n        \"Image upload failed due to a XHR Transport error. Code: \" + xhr.status\n      );\n    };\n    formData = new FormData();\n    formData.append(\"file\", blobInfo.blob(), blobInfo.filename());\n    if (custom_images_upload_param) {\n      Object.keys(custom_images_upload_param).forEach((key) => {\n        formData.append(key, custom_images_upload_param[key]);\n      });\n    }\n    xhr.send(formData);\n  });\n}\nfunction getContentStyle(style) {\n  const defaultStyle = `body{font-size: 14px;} img{padding: 0 2px;} `;\n  return defaultStyle + (style ? style : \"\");\n}\nconst scriptLoaderCreator = () => {\n  let state = {\n    status: {},\n    loadedCallbacks: {}\n  };\n  const creactScriptElm = (url, callback) => {\n    const scriptElm = document.createElement(\"script\");\n    scriptElm.id = uuid(\"tiny-script\");\n    scriptElm.type = \"application/javascript\";\n    scriptElm.src = url;\n    scriptElm.referrerPolicy = \"origin\";\n    const handler = () => {\n      scriptElm.removeEventListener(\"load\", handler);\n      callback();\n    };\n    scriptElm.addEventListener(\"load\", handler);\n    (document.head || document.body).appendChild(scriptElm);\n  };\n  const execCallbacks = (url) => {\n    if (!state.loadedCallbacks[url])\n      return;\n    state.loadedCallbacks[url].forEach((callback) => {\n      if (typeof callback[\"handler\"] === \"function\") {\n        callback[\"handler\"].call(callback.scope);\n      }\n    });\n    state.loadedCallbacks[url] = void 0;\n  };\n  const load = (url, callback, scope) => {\n    if (callback) {\n      if (!state.loadedCallbacks[url]) {\n        state.loadedCallbacks[url] = [];\n      }\n      state.loadedCallbacks[url].push({\n        handler: callback,\n        scope: scope || globalThis\n      });\n    }\n    if (state.status[url] === \"LOADED\") {\n      execCallbacks(url);\n      return;\n    }\n    if (state.status[url] !== \"LOADING\") {\n      state.status[url] = \"LOADING\";\n      creactScriptElm(url, () => {\n        state.status[url] = \"LOADED\";\n        execCallbacks(url);\n      });\n    }\n  };\n  return {\n    load\n  };\n};\nconst scriptLoader = scriptLoaderCreator();\nconst _hoisted_1 = [\"id\"];\nconst _hoisted_2 = { key: 0 };\nconst __default__ = {\n  name: \"Vue3Tinymce\"\n};\nconst _sfc_main = /* @__PURE__ */ Object.assign(__default__, {\n  props: {\n    modelValue: String,\n    setting: { type: Object, default: () => ({}) },\n    setup: Function,\n    disabled: Boolean,\n    scriptSrc: String,\n    debug: Boolean\n  },\n  emits: [\"update:modelValue\", \"init\", \"change\"],\n  setup(__props, { expose, emit }) {\n    const props = __props;\n    let mounting = true;\n    const state = reactive({\n      editor: null,\n      id: uuid(\"tinymce\"),\n      err: \"\"\n    });\n    const getModelValue = () => {\n      var _a;\n      return String((_a = props.modelValue) != null ? _a : \"\");\n    };\n    const updateValue = (val) => emit(\"update:modelValue\", val);\n    const printLog = (e, val, oldVal) => {\n      if (!props.debug)\n        return;\n      console.log(`\\u6765\\u81EA\\uFF1A${e.type} | \n ${val} \n ${oldVal || \"--\"}`);\n    };\n    const onChanged = (e, editor) => {\n      if (!editor)\n        editor = state.editor;\n      const content = getContent(editor);\n      printLog(e, content);\n      updateValue(content);\n      emit(\"change\", content);\n    };\n    const onInited = (editor) => {\n      setContent(getModelValue(), editor);\n      if (props.disabled && editor.mode.get() !== \"readonly\") {\n        setModeDisabled(editor);\n      }\n      editor.on(\"change input undo redo\", (e) => {\n        onChanged(e, editor);\n      });\n      emit(\"init\", editor);\n    };\n    const initEditor = () => {\n      var _a;\n      if (getTinymce() === null) {\n        state.err = \"tinymce is null\";\n        return;\n      }\n      if (props.debug) {\n        console.warn(\"vue3-tinymce \\u8FDB\\u5165debug\\u6A21\\u5F0F\");\n      }\n      let setting = {\n        ...props.setting,\n        selector: `#${state.id}`,\n        content_style: getContentStyle((_a = props.setting) == null ? void 0 : _a.content_style),\n        setup: (editor) => {\n          state.editor = editor;\n          if (props.setup)\n            props.setup(editor);\n          editor.on(\"init\", () => onInited(editor));\n        }\n      };\n      if (props.setting.custom_images_upload) {\n        setting.images_upload_handler = (...arg) => {\n          return imageUploadHandler.apply(null, [props.setting, ...arg]);\n        };\n      }\n      getTinymce().init(setting);\n      mounting = false;\n    };\n    watch(\n      () => props.modelValue,\n      (val, oldVal) => {\n        if (!state.editor || !state.editor.initialized)\n          return;\n        if (oldVal === val || val === getContent(state.editor))\n          return;\n        printLog({ type: \"propsChanged to setContent\" }, val, oldVal);\n        if (val === null)\n          return resetContent(\"\", state.editor);\n        setContent(getModelValue(), state.editor);\n      }\n    );\n    watch(\n      () => props.disabled,\n      (val) => {\n        if (!state.editor || !state.editor.initialized)\n          return;\n        setModeDisabled(state.editor, val);\n      }\n    );\n    expose({\n      id: state.id,\n      editor: state.editor\n    });\n    onMounted(() => {\n      var _a;\n      if (getTinymce() !== null) {\n        initEditor();\n        return;\n      }\n      const scriptSrc = (_a = props.scriptSrc) != null ? _a : \"https://cdn.bootcdn.net/ajax/libs/tinymce/6.1.2/tinymce.min.js\";\n      scriptLoader.load(scriptSrc, initEditor);\n    });\n    onActivated(() => {\n      if (!mounting)\n        initEditor();\n    });\n    onDeactivated(() => {\n      var _a;\n      if (!state.editor)\n        return;\n      (_a = getTinymce()) == null ? void 0 : _a.remove(`#${state.id}`);\n    });\n    onBeforeUnmount(() => {\n      var _a;\n      if (!state.editor)\n        return;\n      (_a = getTinymce()) == null ? void 0 : _a.remove(`#${state.id}`);\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(Fragment, null, [\n        createElementVNode(\"div\", {\n          id: state.id,\n          class: \"tiny-textarea\"\n        }, null, 8, _hoisted_1),\n        state.err ? (openBlock(), createElementBlock(\"p\", _hoisted_2, toDisplayString(state.err), 1)) : createCommentVNode(\"\", true)\n      ], 64);\n    };\n  }\n});\n_sfc_main.install = function(app) {\n  app.component(\"Vue3Tinymce\", _sfc_main);\n};\nexport { _sfc_main as default };\n"],"names":["uuid","prefix","Date","now","Math","floor","random","getTinymce","root","window","global","tinymce","getContent","editor","setContent","val","setModeDisabled","disabled","mode","set","imageUploadHandler","setting","blobInfo","progress","Promise","resolve","reject","xhr","formData","images_upload_url","images_upload_credentials","custom_images_upload_header","custom_images_upload_param","custom_images_upload_callback","XMLHttpRequest","withCredentials","open","Object","keys","forEach","key","setRequestHeader","upload","onprogress","e","loaded","total","onload","status","message","remove","json","JSON","parse","responseText","backImgUrl","location","onerror","FormData","append","blob","filename","send","scriptLoader","scriptLoaderCreator","state","loadedCallbacks","execCallbacks","url","callback","call","scope","load","push","handler","globalThis","creactScriptElm","scriptElm","document","createElement","id","type","src","referrerPolicy","removeEventListener","addEventListener","head","body","appendChild","_hoisted_1","_hoisted_2","__default__","name","_sfc_main","assign","props","modelValue","String","default","setup","Function","Boolean","scriptSrc","debug","emits","__props","expose","emit","mounting","reactive","err","getModelValue","_a","printLog","oldVal","console","log","onChanged","content","initEditor","warn","selector","content_style","style","on","get","onInited","custom_images_upload","images_upload_handler","arg","apply","init","watch","initialized","resetContent","setDirty","undoManager","clear","onMounted","onActivated","onDeactivated","onBeforeUnmount","_ctx","_cache","openBlock","createElementBlock","Fragment","createElementVNode","class","toDisplayString","createCommentVNode","install","app","component"],"mappings":"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","x_google_ignoreList":[0]}