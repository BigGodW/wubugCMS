{"version":3,"file":"index-legacy5.js","sources":["../../../src/views/category/index.vue"],"sourcesContent":["<template>\n  <!-- 搜索区域 -->\n  <div class=\"search row justify-between align-c pd-20 mb-20\">\n    <el-form :inline=\"true\" :model=\"params\">\n      <el-form-item label=\"名称\" prop=\"keywords\">\n        <el-input\n          placeholder=\"请输入栏目名称\"\n          :suffix-icon=\"Search\"\n          v-model=\"params.keywords\"\n          clearable\n        />\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"search\" round>搜索</el-button>\n        <el-button @click=\"clearSearch\" round>清空</el-button>\n      </el-form-item>\n    </el-form>\n    <router-link to=\"/category/add\">\n      <el-button type=\"primary\" @click=\"search\" round>新增</el-button>\n    </router-link>\n  </div>\n\n  <el-table\n    ref=\"multipleTable\"\n    :data=\"tableData\"\n    tooltip-effect=\"dark\"\n    row-key=\"id\"\n    size=\"small\"\n    :tree-props=\"{ children: 'children', hasChildren: 'hasChildren' }\"\n    @selection-change=\"handleSelectionChange\"\n    v-loading=\"loading\"\n  >\n    <el-table-column type=\"selection\"></el-table-column>\n\n    <el-table-column prop=\"id\" label=\"编号\"></el-table-column>\n\n    <el-table-column prop=\"name\" label=\"名称\"></el-table-column>\n\n    <el-table-column prop=\"type\" label=\"类型\">\n      <template #default=\"scope\">\n        <p v-if=\"scope.row.type == 0\">栏目</p>\n        <p v-else>单页</p>\n      </template>\n    </el-table-column>\n\n    <el-table-column prop=\"sort\" label=\"排序\">\n      <template #default=\"scope\">{{ scope.row.sort }}</template>\n    </el-table-column>\n\n    <el-table-column prop=\"status\" label=\"状态\">\n      <template #default=\"scope\">\n        <p v-if=\"scope.row.status == 0\">显示</p>\n        <p v-else>隐藏</p>\n      </template>\n    </el-table-column>\n\n    <el-table-column fixed=\"right\" label=\"操作\" width=\"160\">\n      <template #default=\"scope\">\n        <el-button\n          :icon=\"View\"\n          circle\n          @click=\"handleClick(scope.row)\"\n        ></el-button>\n        <el-button :icon=\"Edit\" circle @click=\"toEdit(scope.row)\"></el-button>\n        <el-button\n          :icon=\"Delete\"\n          circle\n          @click=\"handleDel(scope.row)\"\n        ></el-button>\n      </template>\n    </el-table-column>\n  </el-table>\n</template>\n\n<script>\nimport { Delete, Edit, View, Search } from \"@element-plus/icons-vue\";\nimport { findSubId, destory, search } from \"@/api/category.js\";\nimport { tree, addLabelValue } from \"@/utils/tool.js\";\n\nexport default {\n  name: \"category-index\",\n  setup() {\n    return {\n      Edit,\n      Delete,\n      View,\n      Search,\n    };\n  },\n  data: () => {\n    return {\n      params: {\n        keywords: \"\",\n      },\n      loading: true,\n      tableData: [],\n      multipleSelection: [],\n    };\n  },\n  computed: {},\n  created() {\n    this.search();\n  },\n  methods: {\n    //清空\n    clearSearch() {\n      this.params.keywords = \"\";\n      this.tableData = [];\n      this.multipleSelection = [];\n      this.search();\n    },\n\n    //查询\n    async search() {\n      try {\n        const q = this.params.keywords;\n        let res = await search(q);\n        if (res.code === 200) {\n          let data = tree(res.data);\n          console.log(\"data->\", data);\n          this.tableData = addLabelValue(data);\n          this.loading = false;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //全选和反选\n    toggleSelection(rows) {\n      if (rows) {\n        rows.forEach((row) => {\n          this.$refs.multipleTable.toggleRowSelection(row);\n        });\n      } else {\n        this.$refs.multipleTable.clearSelection();\n      }\n    },\n\n    //选择\n    handleSelectionChange(val) {\n      this.multipleSelection = val;\n    },\n\n    //编辑\n    toEdit(e) {\n      let id = e.id;\n      this.$router.push({ name: \"category-edit\", params: { id: id } });\n    },\n\n    //查询是否有子栏目\n    async hasChild(id) {\n      try {\n        let res = await findSubId(id);\n        if (res.code === 200) {\n          if (res.data.length > 0) {\n            return true;\n          } else {\n            return false;\n          }\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //删除\n    async del(id) {\n      try {\n        let res = await destory(id);\n        if (res.code === 200) {\n          this.$message({\n            message: \"删除成功 ^_^\",\n            type: \"success\",\n          });\n          this.clearSearch();\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    delSome() {},\n\n    //删除栏目  还需要判断是否当前栏目下面有文章？\n    handleDel(e) {\n      let id = e.id;\n      let has = this.hasChild(id);\n      //判断是否有子栏目\n      if (has.length > 0) {\n        this.$message({\n          message: \"我下面还有栏目啊 ^_^\",\n          type: \"success\",\n        });\n        return false;\n      } else {\n        this.del(id);\n      }\n    },\n  },\n};\n</script>\n\n<style scoped>\n:deep(.el-form-item) {\n  margin-bottom: 0px;\n}\n</style>\n"],"names":["_hoisted_1","class","name","setup","Delete","Search","data","params","multipleSelection","created","methods","this","tableData","res","search","q","code","addLabelValue","loading","console","log","error","toggleSelection","rows","forEach","row","$refs","multipleTable","clearSelection","toEdit","e","async","id","length","$message","message","type","clearSearch","_createElementVNode","inline","model","_ctx","label","prop","placeholder","$setup","modelValue","keywords","_cache","$event","clearable","onClick","$options","round","ref","size","children","hasChildren","onSelectionChange","handleSelectionChange","_openBlock","_createElementBlock","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","fixed","width","icon","View","circle","handleClick","scope","Edit","handleDel"],"mappings":"yiCAEOA,EAAA,CAAAC,MAAA,wGA6EP,CACEC,KAAA,iBACAC,MAAAA,KACE,QAEEC,OAAAA,SAEAC,OAAAA,IAGJC,KAAAA,KACE,CACEC,OAAA,sCAKAC,kBAAA,iBAIJC,yBAGAC,QAAA,uCAIIC,KAAAC,UAAA,2DAOA,iCAEE,IAAAC,QAAAC,EAAAC,GACA,GAAA,MAAAF,EAAAG,KAAA,yCAGEL,KAAAC,UAAAK,EAAAX,GACAK,KAAAO,SAAA,CACF,WAEAC,QAAAC,IAAAC,EACF,GAIFC,gBAAAC,GACEA,EACEA,EAAAC,SAAAC,sDAIAd,KAAAe,MAAAC,cAAAC,qEAUJC,OAAAC,uEAMAC,eAAAC,GACE,qBAEE,GAAA,MAAAnB,EAAAG,KACE,OAAAH,EAAAP,KAAA2B,OAAA,WAOFd,QAAAC,IAAAC,EACF,gBAKA,IAEE,mBAAAL,OACEL,KAAAuB,SAAA,CACEC,QAAA,WACAC,KAAA,YAEFzB,KAAA0B,wBAGFlB,QAAAC,IAAAC,EACF,uCAUA,oBAAAY,OAAA,SACEtB,KAAAuB,SAAA,CACEC,QAAA,eACAC,KAAA,yIA9LRE,EAAA,MAAAtC,EAAA,MACYuC,QAAA,EAAeC,MAAAC,EAAAlC,8BACTmC,MAAA,KAAWC,KAAA,kCAErBC,YAAA,UACC,cAAAC,EAAAxC,OACQyC,WAAAL,EAAAlC,OAAAwC,SAAA,sBAAAC,EAAA,KAAAA,EAAA,GAAAC,GAAAR,EAAAlC,OAAAwC,SAAAE,GACTC,UAAA,iFAISd,KAAA,UAAgBe,QAAAC,EAAAtC,OAAeuC,MAAA,yDAC9BF,QAAAC,EAAAf,YAAoBgB,MAAA,iIAIvBjB,KAAA,UAAgBe,QAAAC,EAAAtC,OAAeuC,MAAA,2EAK5CC,IAAA,gBACChD,KAAAmC,EAAA7B,UACD,iBAAA,OACA,UAAA,KACA2C,KAAA,QACC,aAAA,CAAAC,SAAA,WAAAC,YAAA,eACAC,kBAAAN,EAAAO,qEAKgBhB,KAAA,KAAUD,MAAA,YAEVC,KAAA,OAAYD,MAAA,YAEZC,KAAA,OAAYD,MAAA,qCAEzBkB,IAAAC,EAAA,IAAAC,EAAA,QACAF,IAAAC,EAAA,IAAAE,EAAA,qBAIapB,KAAA,OAAYD,MAAA,uDAIZC,KAAA,SAAcD,MAAA,uCAE3BkB,IAAAC,EAAA,IAAAG,EAAA,QACAJ,IAAAC,EAAA,IAAAI,EAAA,qBAIaC,MAAA,QAAcxB,MAAA,KAAWyB,MAAA,4BAGnCC,KAAAvB,EAAAwB,KACDC,OAAA,GACCnB,QAAAF,GAAAR,EAAA8B,YAAAC,EAAA/C,sCAES2C,KAAAvB,EAAA4B,KAAYH,OAAA,GAAQnB,QAAAF,GAAAG,EAAAvB,OAAA2C,EAAA/C,sCAE7B2C,KAAAvB,EAAAzC,OACDkE,OAAA,GACCnB,QAAAF,GAAAG,EAAAsB,UAAAF,EAAA/C"}