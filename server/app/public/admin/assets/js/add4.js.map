{"version":3,"file":"add4.js","sources":["../../../src/views/category/add.vue"],"sourcesContent":["<template>\n  <div class=\"mr-10 ml-10\">\n    <el-tabs v-model=\"activeName\" @tab-click=\"handleClick\">\n      <el-tab-pane label=\"基本信息\" name=\"first\"></el-tab-pane>\n      <el-tab-pane label=\"SEO设置\" name=\"second\"></el-tab-pane>\n    </el-tabs>\n  </div>\n\n  <div class=\"mr-10 ml-10 mb-20\">\n    <el-form ref=\"params\" :model=\"params\" label-width=\"84px\">\n      <div v-show=\"activeIndex == 0\">\n        <el-form-item label=\"上级栏目\">\n          <el-cascader\n            :props=\"categoryProps\"\n            :show-all-levels=\"false\"\n            v-model=\"categorySelected\"\n            :options=\"category\"\n            @change=\"handleChange\"\n          >\n          </el-cascader>\n          不选择为顶级栏目\n        </el-form-item>\n\n        <el-form-item\n          label=\"栏目名称\"\n          prop=\"name\"\n          :rules=\"[\n            {\n              required: true,\n              message: '请输入栏目名称',\n              trigger: 'blur',\n            },\n            {\n              min: 1,\n              max: 10,\n              message: '栏目不能超过10个字',\n              trigger: 'blur',\n            },\n          ]\"\n        >\n          <el-input v-model=\"params.name\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目标识\">\n          <el-input v-model=\"params.pinyin\" disabled></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目路径\">\n          <el-input v-model=\"allPath\" disabled></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目类型\">\n          <el-radio v-model=\"params.type\" label=\"0\">栏目</el-radio>\n          <el-radio v-model=\"params.type\" label=\"1\">单页</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"扩展模型\">\n          <el-radio-group v-model=\"params.mid\">\n            <el-radio label=\"0\">基本模型</el-radio>\n            <el-radio\n              v-for=\"(item, index) of modList\"\n              :key=\"index\"\n              :label=\"item.id\"\n              >{{ item.model_name }}</el-radio\n            >\n          </el-radio-group>\n        </el-form-item>\n\n        <el-form-item label=\"是否显示\">\n          <el-radio v-model=\"params.status\" label=\"0\">显示</el-radio>\n          <el-radio v-model=\"params.status\" label=\"1\">隐藏</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"栏目排序\">\n          <el-input v-model=\"params.sort\"></el-input>\n        </el-form-item>\n      </div>\n\n      <div v-show=\"activeIndex == 1\">\n        <el-form-item label=\"栏目描述\">\n          <el-input v-model=\"params.description\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"栏目链接\">\n          <el-input v-model=\"params.url\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"打开方式\">\n          <el-radio v-model=\"params.target\" label=\"0\">当前页面</el-radio>\n          <el-radio v-model=\"params.target\" label=\"1\">新页面</el-radio>\n        </el-form-item>\n\n        <el-form-item label=\"seo标题\">\n          <el-input v-model=\"params.seo_title\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"seo关键词\">\n          <el-input v-model=\"params.seo_keywords\"></el-input>\n        </el-form-item>\n\n        <el-form-item label=\"seo描述\">\n          <el-input v-model=\"params.seo_description\"></el-input>\n        </el-form-item>\n      </div>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"submit('params')\">保存</el-button>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script>\nimport { find, create } from \"@/api/category.js\";\nimport { addLabelValue, tree } from \"@/utils/tool.js\";\nimport { list } from \"@/api/model.js\";\nimport { pinyin } from \"pinyin-pro\";\nexport default {\n  name: \"category-add\",\n  data: () => {\n    return {\n      categorySelected: [], //-1默认选中顶级栏目\n      categoryProps: { checkStrictly: true },\n      activeName: \"first\", //tab 默认显示第一个\n      activeIndex: \"0\", //tab 内容默认显示第一个\n      category: [], //当前所有栏目\n      modList: [], //模型列表\n      params: {\n        //接口入参\n        pid: 0,\n        seo_title: \"\",\n        seo_keywords: \"\",\n        seo_description: \"\",\n        name: \"\",\n        path: \"\",\n        pinyin: \"\",\n        mid: \"0\",\n        description: \"\",\n        url: \"\",\n        sort: 0,\n        type: \"0\",\n        target: \"0\",\n        status: \"0\",\n      },\n      paramsRules: {\n        //校验规则\n        name: [\n          { required: true, message: \"请输入栏目名称\", trigger: \"blur\" },\n          {\n            min: 2,\n            max: 10,\n            message: \"名称长度在 2 到 10 个字符之间\",\n            trigger: \"blur\",\n          },\n        ],\n      },\n    };\n  },\n  computed: {\n    allPath() {\n      if (this.params.path == \"\") {\n        return this.params.path + \"/\" + this.params.pinyin;\n      } else {\n        return this.params.path + this.params.pinyin;\n      }\n    },\n  },\n  created() {\n    this.query();\n    this.modelList();\n  },\n  watch: {\n    \"params.name\": function (newv, oldv) {\n      this.params.pinyin = pinyin(newv, { toneType: \"none\" }).replace(\n        /\\s+/g,\n        \"\"\n      );\n    },\n  },\n\n  methods: {\n    handleClick(tab) {\n      this.activeIndex = tab.index;\n    },\n    //查询\n    async query() {\n      try {\n        let res = await find();\n        if (res.code === 200) {\n          let data = addLabelValue(tree(res.data));\n          this.cate = res.data;\n          this.category = [...data];\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    handleChange(e) {\n      //获取路径\n      let path = [];\n      let ids = Object.values(e);\n      console.log(ids);\n      ids.forEach((item) => {\n        this.cate.forEach((sub) => {\n          if (sub.id == item) {\n            path.push(\"/\" + sub.pinyin);\n          }\n        });\n      });\n\n      this.params.path = path.join(\"\") + \"/\";\n      if (e[0] != -1) {\n        this.params.pid = e[e.length - 1];\n      }\n    },\n\n    //模型列表\n    async modelList() {\n      try {\n        let res = await list(this.cur);\n        if (res.code === 200) {\n          this.modList = res.data.list;\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    //更新基本信息\n    async categoryAdd() {\n      try {\n        let res = await create(this.params);\n        if (res.code) {\n          this.$message({\n            message: \"更新成功^_^\",\n            type: \"success\",\n          });\n          this.$router.go(-1);\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    },\n\n    submit(formName) {\n      this.params.path = this.allPath;\n      this.$refs[formName].validate((valid) => {\n        if (valid) {\n          this.categoryAdd();\n        } else {\n          console.log(\"error submit!!\");\n          return false;\n        }\n      });\n    },\n  },\n};\n</script>\n<style scoped></style>\n"],"names":["_hoisted_1","class","_hoisted_2","name","data","categorySelected","categoryProps","checkStrictly","activeName","category","modList","params","seo_keywords","seo_description","path","pinyin","mid","description","url","sort","type","max","trigger","computed","allPath","this","created","modelList","watch","newv","oldv","methods","handleClick","tab","res","find","code","addLabelValue","tree","cate","console","log","error","handleChange","e","ids","forEach","item","sub","id","join","async","create","$message","message","$router","go","submit","formName","$refs","validate","valid","categoryAdd","_createElementVNode","onTabClick","$options","label","ref","model","_ctx","props","options","onChange","prop","rules","modelValue","_cache","$event","disabled","_openBlock","_createElementBlock","_Fragment","_renderList","index","key","_createTextVNode","_toDisplayString","model_name","status","target","seo_title","onClick"],"mappings":"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"}